"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[8056],{92668:(Y,k,n)=>{n.d(k,{Z:()=>f});var e=n(67294),o=n(35752),M=n(29299),g=n(69398),E=n(71068),U=n(96987),i=n(32638),Z=n(45697),t=n.n(Z),D=n(86896),I=n(16550),L=n(16607),x=n(96208),h=n(54425);const N=({tokenName:s,onClickDelete:l,tokenType:c})=>{const{formatMessage:m}=(0,D.Z)(),{trackUsage:p}=(0,i.useTracking)(),[r,d]=(0,e.useState)(!1),u=()=>{d(!1),p("willDeleteToken",{tokenType:c}),l()};return e.createElement(L.x,{paddingLeft:1,onClick:y=>y.stopPropagation()},e.createElement(x.h,{onClick:()=>{d(!0)},label:m({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${s}`}),name:"delete",noBorder:!0,icon:e.createElement(h.Z,null)}),e.createElement(i.ConfirmDialog,{onToggleDialog:()=>d(!1),onConfirm:u,isOpen:r}))};N.propTypes={tokenName:t().string.isRequired,onClickDelete:t().func.isRequired,tokenType:t().string.isRequired};const G=N;var V=n(81851),K=n(1565);const w={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},j=(0,K.ZP)(i.Link)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:s})=>s.colors.neutral800};
      }
    }
  }
`,P=({tokenName:s,tokenId:l,buttonType:c,children:m})=>{const{formatMessage:p}=(0,D.Z)(),{location:{pathname:r}}=(0,I.k6)();return e.createElement(j,{to:`${r}/${l}`,title:p(w[c],{target:s})},m)};P.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired,buttonType:t().string,children:t().node.isRequired},P.defaultProps={buttonType:"edit"};const v=P,T=({tokenName:s,tokenId:l})=>e.createElement(v,{tokenName:s,tokenId:l,buttonType:"read"},e.createElement(V.Z,null));T.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired};const B=T;var F=n(2382);const A=({tokenName:s,tokenId:l})=>e.createElement(v,{tokenName:s,tokenId:l},e.createElement(F.Z,null));A.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired};const O=A,S=({permissions:s,headers:l,contentType:c,isLoading:m,tokens:p,onConfirmDelete:r,tokenType:d})=>{const{canDelete:u,canUpdate:y,canRead:R}=s;return e.createElement(i.DynamicTable,{headers:l,contentType:c,rows:p,withBulkActions:u||y||R,isLoading:m,onConfirmDelete:r},e.createElement(C,{tokenType:d,permissions:s,onConfirmDelete:r}))};S.propTypes={tokens:t().array,permissions:t().shape({canRead:t().bool,canDelete:t().bool,canUpdate:t().bool}).isRequired,headers:t().arrayOf(t().shape({cellFormatter:t().func,key:t().string.isRequired,metadatas:t().shape({label:t().string.isRequired,sortable:t().bool}).isRequired,name:t().string.isRequired})),contentType:t().string.isRequired,isLoading:t().bool,onConfirmDelete:t().func,tokenType:t().string.isRequired},S.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const f=S,C=({tokenType:s,permissions:l,rows:c,withBulkActions:m,onConfirmDelete:p})=>{const{canDelete:r,canUpdate:d,canRead:u}=l,[{query:y}]=(0,i.useQueryParams)(),{formatMessage:R}=(0,D.Z)(),[,$]=y?y.sort.split(":"):"ASC",{push:b,location:{pathname:H}}=(0,I.k6)(),{trackUsage:W}=(0,i.useTracking)(),Q=c.sort((a,J)=>{const z=a.name.localeCompare(J.name);return $==="DESC"?-z:z});return e.createElement(o.p,null,Q.map(a=>e.createElement(M.Tr,{key:a.id,...(0,i.onRowClick)({fn(){W("willEditTokenFromList",{tokenType:s}),b(`${H}/${a.id}`)},condition:d})},e.createElement(g.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(E.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},a.name)),e.createElement(g.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(E.Z,{textColor:"neutral800",ellipsis:!0},a.description)),e.createElement(g.Td,null,e.createElement(E.Z,{textColor:"neutral800"},e.createElement(i.RelativeTime,{timestamp:new Date(a.createdAt)}))),e.createElement(g.Td,null,a.lastUsedAt&&e.createElement(E.Z,{textColor:"neutral800"},e.createElement(i.RelativeTime,{timestamp:new Date(a.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:R({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),m&&e.createElement(g.Td,null,e.createElement(U.k,{justifyContent:"end"},d&&e.createElement(O,{tokenName:a.name,tokenId:a.id}),!d&&u&&e.createElement(B,{tokenName:a.name,tokenId:a.id}),r&&e.createElement(G,{tokenName:a.name,onClickDelete:()=>p(a.id),tokenType:s}))))))};C.defaultProps={rows:[],withBulkActions:!1},C.propTypes={rows:t().array,permissions:t().shape({canRead:t().bool,canDelete:t().bool,canUpdate:t().bool}).isRequired,onConfirmDelete:t().func.isRequired,tokenType:t().string.isRequired,withBulkActions:t().bool}},81966:(Y,k,n)=>{n.d(k,{Z:()=>e,f:()=>o});const e="api-token",o="transfer-token"},71362:(Y,k,n)=>{n.r(k),n.d(k,{default:()=>P});var e=n(67294),o=n(32638),M=n(86706),g=n(36364),E=n(40720),U=n(90731),i=n(34726),Z=n(83598),t=n(36232),D=n.n(t),I=n(86896),L=n(88767),x=n(16550),h=n(81966),N=n(92668);const V=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],w=()=>{(0,o.useFocusWhenNavigate)();const v=(0,L.useQueryClient)(),{formatMessage:T}=(0,I.Z)(),B=(0,o.useNotification)(),F=(0,M.v9)(g._),{allowedActions:{canCreate:A,canDelete:O,canUpdate:S,canRead:f}}=(0,o.useRBAC)(F.settings["api-tokens"]),{push:C}=(0,x.k6)(),{trackUsage:s}=(0,o.useTracking)(),{startSection:l}=(0,o.useGuidedTour)(),c=e.useRef(l),{get:m,del:p}=(0,o.useFetchClient)(),{formatAPIError:r}=(0,o.useAPIErrorHandler)();e.useEffect(()=>{c.current&&c.current("apiTokens")},[]),e.useEffect(()=>{C({search:D().stringify({sort:"name:ASC"},{encode:!1})})},[C]);const d=V.map(a=>({...a,metadatas:{...a.metadatas,label:T(a.metadatas.label)}})),{data:u,isLoading:y}=(0,L.useQuery)(["api-tokens"],async()=>{s("willAccessTokenList",{tokenType:h.Z});const{data:{data:a}}=await m("/admin/api-tokens");return s("didAccessTokenList",{number:a.length,tokenType:h.Z}),a},{cacheTime:0,enabled:f,onError(a){B({type:"warning",message:r(a)})}}),R=y,$=(0,L.useMutation)(async a=>{await p(`/admin/api-tokens/${a}`)},{async onSuccess(){await v.invalidateQueries(["api-tokens"]),s("didDeleteToken")},onError(a){B({type:"warning",message:r(a)})}}),b=u&&u.length>0,H=f&&b,W=f&&!b&&!A,Q=f&&!b&&A;return e.createElement(E.o,{"aria-busy":R},e.createElement(o.SettingsPageTitle,{name:"API Tokens"}),e.createElement(U.T,{title:T({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:T({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:A&&e.createElement(o.LinkButton,{"data-testid":"create-api-token-button",startIcon:e.createElement(Z.Z,null),size:"S",onClick:()=>s("willAddTokenFromList",{tokenType:h.Z}),to:"/settings/api-tokens/create"},T({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"}))}),e.createElement(i.D,null,!f&&e.createElement(o.NoPermissions,null),H&&e.createElement(N.Z,{permissions:{canRead:f,canDelete:O,canUpdate:S},headers:d,contentType:"api-tokens",rows:u,isLoading:R,onConfirmDelete:a=>$.mutateAsync(a),tokens:u,tokenType:h.Z}),Q&&e.createElement(o.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(o.LinkButton,{variant:"secondary",startIcon:e.createElement(Z.Z,null),to:"/settings/api-tokens/create"},T({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),W&&e.createElement(o.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},P=()=>{const v=(0,M.v9)(g._);return e.createElement(o.CheckPagePermissions,{permissions:v.settings["api-tokens"].main},e.createElement(w,null))}}}]);
