"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[8418],{38977:(D,h,t)=>{t.r(h),t.d(h,{default:()=>oe});var e=t(67294),B=t(334),C=t(40720),P=t(90731),O=t(34726),a=t(32638),E=t(86896),f=t(88767),v=t(84419),l=t(99688),T=t(74622),y=t(36854),J=t(71543),Q=t(31988),M=t(6498),V=t(457),W=t(37022),b=t(12473),X=t(82392),L=t(75071),Y=t(41054),K=t(45697),n=t.n(K),u=t(87561);const k=u.Ry().shape({options:u.Ry().shape({from:u.Ry().shape({name:u.Z_().required(a.translatedErrors.required),email:u.Z_().email(a.translatedErrors.email).required(a.translatedErrors.required)}).required(),response_email:u.Z_().email(a.translatedErrors.email),object:u.Z_().required(a.translatedErrors.required),message:u.Z_().required(a.translatedErrors.required)}).required(a.translatedErrors.required)}),I=({template:s,onToggle:m,onSubmit:o})=>{const{formatMessage:r}=(0,E.Z)();return e.createElement(T.P,{onClose:m,labelledBy:`${r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,l.OB)(s.display),defaultMessage:s.display})}`},e.createElement(y.x,null,e.createElement(X.O,{label:`${r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,l.OB)(s.display),defaultMessage:s.display})}`},e.createElement(L.$,null,r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})),e.createElement(L.$,{isCurrent:!0},r({id:(0,l.OB)(s.display),defaultMessage:s.display})))),e.createElement(Y.J9,{onSubmit:o,initialValues:s,validateOnChange:!1,validationSchema:k,enableReinitialize:!0},({errors:c,values:p,handleChange:g,isSubmitting:Z})=>e.createElement(a.Form,null,e.createElement(J.f,null,e.createElement(Q.r,{gap:5},e.createElement(M.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.from.name.label"),defaultMessage:"Shipper name"},name:"options.from.name",onChange:g,value:p.options.from.name,error:c?.options?.from?.name,type:"text"})),e.createElement(M.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.from.email.label"),defaultMessage:"Shipper email"},name:"options.from.email",onChange:g,value:p.options.from.email,error:c?.options?.from?.email,type:"text"})),e.createElement(M.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.response_email.label"),defaultMessage:"Response email"},name:"options.response_email",onChange:g,value:p.options.response_email,error:c?.options?.response_email,type:"text"})),e.createElement(M.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.object.label"),defaultMessage:"Subject"},name:"options.object",onChange:g,value:p.options.object,error:c?.options?.object,type:"text"})),e.createElement(M.P,{col:12,s:12},e.createElement(V.g,{label:r({id:(0,l.OB)("PopUpForm.Email.options.message.label"),defaultMessage:"Message"}),id:"options.message",onChange:g,value:p.options.message,error:c?.options?.message&&r({id:c.options.message,defaultMessage:c.options.message})})))),e.createElement(W.m,{startActions:e.createElement(b.z,{onClick:m,variant:"tertiary"},"Cancel"),endActions:e.createElement(b.z,{loading:Z,type:"submit"},"Finish")}))))};I.propTypes={template:n().shape({display:n().string,icon:n().string,options:n().shape({from:n().shape({name:n().string,email:n().string}),message:n().string,object:n().string,response_email:n().string})}).isRequired,onSubmit:n().func.isRequired,onToggle:n().func.isRequired};const w=I;var q=t(5923),_=t(3547),F=t(29299),d=t(69398),A=t(22304),R=t(71068),ee=t(35752),U=t(85200),j=t(96208),te=t(75975),H=t(2382),ae=t(18226);const N=({canUpdate:s,onEditClick:m})=>{const{formatMessage:o}=(0,E.Z)();return e.createElement(q.i,{colCount:3,rowCount:3},e.createElement(_.h,null,e.createElement(F.Tr,null,e.createElement(d.Th,{width:"1%"},e.createElement(A.T,null,o({id:(0,l.OB)("Email.template.table.icon.label"),defaultMessage:"icon"}))),e.createElement(d.Th,null,e.createElement(R.Z,{variant:"sigma",textColor:"neutral600"},o({id:(0,l.OB)("Email.template.table.name.label"),defaultMessage:"name"}))),e.createElement(d.Th,{width:"1%"},e.createElement(A.T,null,o({id:(0,l.OB)("Email.template.table.action.label"),defaultMessage:"action"}))))),e.createElement(ee.p,null,e.createElement(F.Tr,{...(0,a.onRowClick)({fn:()=>m("reset_password")})},e.createElement(d.Td,null,e.createElement(U.J,null,e.createElement(te.Z,{"aria-label":o({id:"global.reset-password",defaultMessage:"Reset password"})}))),e.createElement(d.Td,null,e.createElement(R.Z,null,o({id:"global.reset-password",defaultMessage:"Reset password"}))),e.createElement(d.Td,{...a.stopPropagation},e.createElement(j.h,{onClick:()=>m("reset_password"),label:o({id:(0,l.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:s&&e.createElement(H.Z,null)}))),e.createElement(F.Tr,{...(0,a.onRowClick)({fn:()=>m("email_confirmation")})},e.createElement(d.Td,null,e.createElement(U.J,null,e.createElement(ae.Z,{"aria-label":o({id:(0,l.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})}))),e.createElement(d.Td,null,e.createElement(R.Z,null,o({id:(0,l.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"}))),e.createElement(d.Td,{...a.stopPropagation},e.createElement(j.h,{onClick:()=>m("email_confirmation"),label:o({id:(0,l.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:s&&e.createElement(H.Z,null)})))))};N.propTypes={canUpdate:n().bool.isRequired,onEditClick:n().func.isRequired};const le=N,se=()=>e.createElement(a.CheckPagePermissions,{permissions:v._.readEmailTemplates},e.createElement(ne,null)),ne=()=>{const{formatMessage:s}=(0,E.Z)(),{trackUsage:m}=(0,a.useTracking)(),{notifyStatus:o}=(0,B.G)(),r=(0,a.useNotification)(),{lockApp:c,unlockApp:p}=(0,a.useOverlayBlocker)(),g=(0,f.useQueryClient)(),{get:Z,put:ie}=(0,a.useFetchClient)(),{formatAPIError:G}=(0,a.useAPIErrorHandler)();(0,a.useFocusWhenNavigate)();const[re,me]=e.useState(!1),[x,de]=e.useState(null),{isLoading:ce,allowedActions:{canUpdate:ue}}=(0,a.useRBAC)({update:v._.updateEmailTemplates}),{isLoading:pe,data:$}=(0,f.useQuery)(["users-permissions","email-templates"],async()=>{const{data:i}=await Z("/users-permissions/email-templates");return i},{onSuccess(){o(s({id:(0,l.OB)("Email.template.data.loaded"),defaultMessage:"Email templates has been loaded"}))},onError(i){r({type:"warning",message:G(i)})}}),Ee=ce||pe,S=()=>{me(i=>!i)},ge=i=>{de(i),S()},z=(0,f.useMutation)(i=>ie("/users-permissions/email-templates",{"email-templates":i}),{async onSuccess(){await g.invalidateQueries(["users-permissions","email-templates"]),r({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}}),m("didEditEmailTemplates"),p(),S()},onError(i){r({type:"warning",message:G(i)}),p()},refetchActive:!0}),fe=i=>{c(),m("willEditEmailTemplates");const ve={...$,[x]:i};z.mutate(ve)};return Ee?e.createElement(C.o,{"aria-busy":"true"},e.createElement(a.SettingsPageTitle,{name:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(P.T,{title:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(O.D,null,e.createElement(a.LoadingIndicatorPage,null))):e.createElement(C.o,{"aria-busy":z.isLoading},e.createElement(a.SettingsPageTitle,{name:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(P.T,{title:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(O.D,null,e.createElement(le,{onEditClick:ge,canUpdate:ue}),re&&e.createElement(w,{template:$[x],onToggle:S,onSubmit:fe})))},oe=se},99688:(D,h,t)=>{t.d(h,{YX:()=>P,OB:()=>O.Z});var e=t(41609),B=t.n(e);const P=a=>Object.keys(a).reduce((E,f)=>{const v=a[f].controllers,l=Object.keys(v).reduce((T,y)=>(B()(v[y])||(T[y]=v[y]),T),{});return B()(l)||(E[f]={controllers:l}),E},{});var O=t(58655)}}]);
