"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[4121],{38542:(Te,w,t)=>{t.r(w),t.d(w,{default:()=>oe});var e=t(67294),o=t(32638),k=t(86706),P=t(36364),z=t(334),H=t(71590),O=t(40720),U=t(90731),G=t(55040),i=t(71068),Z=t(12473),Q=t(34726),Y=t(16607),K=t(5923),j=t(38454),J=t(3547),x=t(29299),l=t(69398),D=t(12803),X=t(22304),q=t(35752),A=t(96987),_=t(89161),B=t(96208),ee=t(96912),f=t(83598),W=t(54425),te=t(2382),ae=t(94355),ne=t(86896),v=t(88767),V=t(16550);const se=()=>{const[b,c]=(0,e.useState)(!1),[C,r]=(0,e.useState)([]),le=(0,k.v9)(P._),{formatMessage:n}=(0,ne.Z)(),{formatAPIError:m}=(0,o.useAPIErrorHandler)(),g=(0,o.useNotification)();(0,o.useFocusWhenNavigate)();const{push:ie}=(0,V.k6)(),{pathname:I}=(0,V.TH)(),{isLoading:re,allowedActions:{canCreate:T,canUpdate:$,canDelete:p}}=(0,o.useRBAC)(le.settings.webhooks),{get:de,post:ce,put:ue}=(0,o.useFetchClient)(),{notifyStatus:N}=(0,z.G)(),me="webhooks",{isLoading:ge,data:d,error:S,refetch:R}=(0,v.useQuery)(me,async()=>{const{data:{data:a}}=await de("/admin/webhooks");return a});(0,e.useEffect)(()=>{if(S){g({type:"warning",message:m(S)});return}d&&N(n({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[d,S,g,n,N,m]);const F=(0,v.useMutation)(async()=>{await ce("/admin/webhooks/batch-delete",{ids:C})},{onError(a){g({type:"warning",message:m(a)}),c(!1)},onSuccess(){r([]),c(!1),R()}}),he=(0,v.useMutation)(async({isEnabled:a,id:s})=>{const{id:E,...L}=d.find(Ce=>Ce.id===s)??{},be={...L,isEnabled:a};await ue(`/admin/webhooks/${s}`,be)},{onError(a){g({type:"warning",message:m(a)})},onSuccess(){R()}}),Ee=()=>F.mutate(),fe=a=>r(a?d.map(s=>s.id):[]),ve=(a,s)=>r(a?E=>[...E,s]:E=>E.filter(L=>L!==s)),M=a=>ie(`${I}/${a}`),y=re||ge,h=d?.length??0,u=C.length;return e.createElement(H.A,null,e.createElement(o.SettingsPageTitle,{name:"Webhooks"}),e.createElement(O.o,{"aria-busy":y},e.createElement(U.T,{title:n({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:n({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:T&&!y&&e.createElement(o.LinkButton,{startIcon:e.createElement(f.Z,null),variant:"default",to:`${I}/create`,size:"S"},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}),u>0&&p&&e.createElement(G.Z,{startActions:e.createElement(e.Fragment,null,e.createElement(i.Z,{variant:"epsilon",textColor:"neutral600"},n({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:u})),e.createElement(Z.z,{onClick:()=>c(!0),startIcon:e.createElement(W.Z,null),size:"L",variant:"danger-light"},n({id:"global.delete",defaultMessage:"Delete"})))}),e.createElement(Q.D,null,y?e.createElement(Y.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(o.LoadingIndicatorPage,null)):h>0?e.createElement(K.i,{colCount:5,rowCount:h+1,footer:e.createElement(j.c,{onClick:()=>T?M("create"):{},icon:e.createElement(f.Z,null)},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))},e.createElement(J.h,null,e.createElement(x.Tr,null,e.createElement(l.Th,null,e.createElement(D.C,{"aria-label":n({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:u>0&&u<h,value:u===h,onValueChange:fe})),e.createElement(l.Th,{width:"20%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(l.Th,{width:"60%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"Settings.webhooks.form.url",defaultMessage:"URL"}))),e.createElement(l.Th,{width:"20%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"}))),e.createElement(l.Th,null,e.createElement(X.T,null,n({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"}))))),e.createElement(q.p,null,d.map(a=>e.createElement(x.Tr,{key:a.id,...(0,o.onRowClick)({fn:()=>M(a.id),condition:$})},e.createElement(l.Td,{...o.stopPropagation},e.createElement(D.C,{"aria-label":`${n({id:"global.select",defaultMessage:"Select"})} ${a.name}`,value:C?.includes(a.id),onValueChange:s=>ve(s,a.id),name:"select"})),e.createElement(l.Td,null,e.createElement(i.Z,{fontWeight:"semiBold",textColor:"neutral800"},a.name)),e.createElement(l.Td,null,e.createElement(i.Z,{textColor:"neutral800"},a.url)),e.createElement(l.Td,null,e.createElement(A.k,null,e.createElement(_.r,{onLabel:n({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:n({id:"global.disabled",defaultMessage:"Disabled"}),label:`${a.name} ${n({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:a.isEnabled,onChange:s=>{s.stopPropagation(),he.mutate({isEnabled:!a.isEnabled,id:a.id})},visibleLabels:!0}))),e.createElement(l.Td,null,e.createElement(A.k,{gap:1},$&&e.createElement(B.h,{label:n({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:e.createElement(te.Z,null),noBorder:!0}),p&&e.createElement(B.h,{onClick:s=>{s.stopPropagation(),r([a.id]),c(!0)},label:n({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),icon:e.createElement(W.Z,null),noBorder:!0}))))))):e.createElement(ee.x,{icon:e.createElement(ae.Z,{width:"160px"}),content:n({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:e.createElement(Z.z,{variant:"secondary",startIcon:e.createElement(f.Z,null),onClick:()=>T?M("create"):{}},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}))),e.createElement(o.ConfirmDialog,{isOpen:b,onToggleDialog:()=>c(a=>!a),onConfirm:Ee,isConfirmButtonLoading:F.isLoading}))},oe=()=>{const b=(0,k.v9)(P._);return e.createElement(o.CheckPagePermissions,{permissions:b.settings.webhooks.main},e.createElement(se,null))}}}]);
