"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[9600],{92668:(K,h,n)=>{n.d(h,{Z:()=>I});var e=n(67294),o=n(35752),M=n(29299),T=n(69398),v=n(71068),U=n(96987),i=n(32638),b=n(45697),t=n.n(b),A=n(86896),N=n(16550),P=n(16607),V=n(96208),R=n(54425);const B=({tokenName:a,onClickDelete:r,tokenType:m})=>{const{formatMessage:f}=(0,A.Z)(),{trackUsage:g}=(0,i.useTracking)(),[l,d]=(0,e.useState)(!1),E=()=>{d(!1),g("willDeleteToken",{tokenType:m}),r()};return e.createElement(P.x,{paddingLeft:1,onClick:y=>y.stopPropagation()},e.createElement(V.h,{onClick:()=>{d(!0)},label:f({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),name:"delete",noBorder:!0,icon:e.createElement(R.Z,null)}),e.createElement(i.ConfirmDialog,{onToggleDialog:()=>d(!1),onConfirm:E,isOpen:l}))};B.propTypes={tokenName:t().string.isRequired,onClickDelete:t().func.isRequired,tokenType:t().string.isRequired};const G=B;var w=n(81851),Q=n(1565);const x={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},j=(0,Q.ZP)(i.Link)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,D=({tokenName:a,tokenId:r,buttonType:m,children:f})=>{const{formatMessage:g}=(0,A.Z)(),{location:{pathname:l}}=(0,N.k6)();return e.createElement(j,{to:`${l}/${r}`,title:g(x[m],{target:a})},f)};D.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired,buttonType:t().string,children:t().node.isRequired},D.defaultProps={buttonType:"edit"};const u=D,p=({tokenName:a,tokenId:r})=>e.createElement(u,{tokenName:a,tokenId:r,buttonType:"read"},e.createElement(w.Z,null));p.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired};const O=p;var L=n(2382);const Z=({tokenName:a,tokenId:r})=>e.createElement(u,{tokenName:a,tokenId:r},e.createElement(L.Z,null));Z.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired};const F=Z,c=({permissions:a,headers:r,contentType:m,isLoading:f,tokens:g,onConfirmDelete:l,tokenType:d})=>{const{canDelete:E,canUpdate:y,canRead:C}=a;return e.createElement(i.DynamicTable,{headers:r,contentType:m,rows:g,withBulkActions:E||y||C,isLoading:f,onConfirmDelete:l},e.createElement(k,{tokenType:d,permissions:a,onConfirmDelete:l}))};c.propTypes={tokens:t().array,permissions:t().shape({canRead:t().bool,canDelete:t().bool,canUpdate:t().bool}).isRequired,headers:t().arrayOf(t().shape({cellFormatter:t().func,key:t().string.isRequired,metadatas:t().shape({label:t().string.isRequired,sortable:t().bool}).isRequired,name:t().string.isRequired})),contentType:t().string.isRequired,isLoading:t().bool,onConfirmDelete:t().func,tokenType:t().string.isRequired},c.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const I=c,k=({tokenType:a,permissions:r,rows:m,withBulkActions:f,onConfirmDelete:g})=>{const{canDelete:l,canUpdate:d,canRead:E}=r,[{query:y}]=(0,i.useQueryParams)(),{formatMessage:C}=(0,A.Z)(),[,$]=y?y.sort.split(":"):"ASC",{push:S,location:{pathname:H}}=(0,N.k6)(),{trackUsage:W}=(0,i.useTracking)(),Y=m.sort((s,J)=>{const z=s.name.localeCompare(J.name);return $==="DESC"?-z:z});return e.createElement(o.p,null,Y.map(s=>e.createElement(M.Tr,{key:s.id,...(0,i.onRowClick)({fn(){W("willEditTokenFromList",{tokenType:a}),S(`${H}/${s.id}`)},condition:d})},e.createElement(T.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(v.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},s.name)),e.createElement(T.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(v.Z,{textColor:"neutral800",ellipsis:!0},s.description)),e.createElement(T.Td,null,e.createElement(v.Z,{textColor:"neutral800"},e.createElement(i.RelativeTime,{timestamp:new Date(s.createdAt)}))),e.createElement(T.Td,null,s.lastUsedAt&&e.createElement(v.Z,{textColor:"neutral800"},e.createElement(i.RelativeTime,{timestamp:new Date(s.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:C({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),f&&e.createElement(T.Td,null,e.createElement(U.k,{justifyContent:"end"},d&&e.createElement(F,{tokenName:s.name,tokenId:s.id}),!d&&E&&e.createElement(O,{tokenName:s.name,tokenId:s.id}),l&&e.createElement(G,{tokenName:s.name,onClickDelete:()=>g(s.id),tokenType:a}))))))};k.defaultProps={rows:[],withBulkActions:!1},k.propTypes={rows:t().array,permissions:t().shape({canRead:t().bool,canDelete:t().bool,canUpdate:t().bool}).isRequired,onConfirmDelete:t().func.isRequired,tokenType:t().string.isRequired,withBulkActions:t().bool}},81966:(K,h,n)=>{n.d(h,{Z:()=>e,f:()=>o});const e="api-token",o="transfer-token"},68446:(K,h,n)=>{n.r(h),n.d(h,{default:()=>D});var e=n(67294),o=n(32638),M=n(86706),T=n(36364),v=n(40720),U=n(90731),i=n(34726),b=n(83598),t=n(36232),A=n.n(t),N=n(86896),P=n(88767),V=n(16550),R=n(81966),B=n(92668);const w=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],x=()=>{(0,o.useFocusWhenNavigate)();const{formatMessage:u}=(0,N.Z)(),p=(0,o.useNotification)(),O=(0,M.v9)(T._),{allowedActions:{canCreate:L,canDelete:Z,canUpdate:F,canRead:c}}=(0,o.useRBAC)(O.settings["transfer-tokens"]),{push:I}=(0,V.k6)(),{trackUsage:k}=(0,o.useTracking)(),{startSection:a}=(0,o.useGuidedTour)(),r=(0,e.useRef)(a),{get:m,del:f}=(0,o.useFetchClient)();(0,e.useEffect)(()=>{r.current&&r.current("transferTokens")},[]),(0,e.useEffect)(()=>{I({search:A().stringify({sort:"name:ASC"},{encode:!1})})},[I]);const g=w.map(s=>({...s,metadatas:{...s.metadatas,label:u(s.metadatas.label)}})),{data:l,status:d,isFetching:E,refetch:y}=(0,P.useQuery)(["transfer-tokens"],async()=>{k("willAccessTokenList",{tokenType:R.f});const{data:{data:s}}=await m("/admin/transfer/tokens");return k("didAccessTokenList",{number:s.length,tokenType:R.f}),s},{enabled:c,onError(s){s?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?p({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):p({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),C=c&&(d!=="success"&&d!=="error"||d==="success"&&E),$=(0,P.useMutation)(async s=>{await f(`/admin/transfer/tokens/${s}`)},{async onSuccess(){await y(["transfer-tokens"])},onError(s){s?.response?.data?.data?p({type:"warning",message:s.response.data.data}):s?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?p({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):p({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),S=l&&l?.length>0,H=c&&S,W=c&&!S&&!L,Y=c&&!S&&L;return e.createElement(v.o,{"aria-busy":C},e.createElement(o.SettingsPageTitle,{name:"Transfer Tokens"}),e.createElement(U.T,{title:u({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:u({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:L?e.createElement(o.LinkButton,{"data-testid":"create-transfer-token-button",startIcon:e.createElement(b.Z,null),size:"S",onClick:()=>k("willAddTokenFromList",{tokenType:R.f}),to:"/settings/transfer-tokens/create"},u({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})):void 0}),e.createElement(i.D,null,!c&&e.createElement(o.NoPermissions,null),H&&e.createElement(B.Z,{permissions:{canRead:c,canDelete:Z,canUpdate:F},headers:g,contentType:"trasfer-tokens",rows:l,isLoading:C,onConfirmDelete:s=>$.mutateAsync(s),tokens:l,tokenType:R.f}),Y&&e.createElement(o.NoContent,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:e.createElement(o.LinkButton,{variant:"secondary",startIcon:e.createElement(b.Z,null),to:"/settings/transfer-tokens/create"},u({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"}))}),W&&e.createElement(o.NoContent,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},D=()=>{const u=(0,M.v9)(T._);return e.createElement(o.CheckPagePermissions,{permissions:u.settings["transfer-tokens"].main},e.createElement(x,null))}}}]);
