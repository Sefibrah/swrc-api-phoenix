"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[4381],{34381:(Y,A,s)=>{s.d(A,{ProtectedListPage:()=>_s});var t=s(92132),P=s(21272),L=s(11273),c=s(42455),I=s(38413),B=s(55356),R=s(74773),E=s(85829),d=s(85963),o=s(4198),l=s(94061),i=s(35513),M=s(40216),U=s(26127),m=s(90361),_=s(33363),C=s(50215),H=s(98765),X=s(25641),$=s(83997),Z=s(95579),k=s(88353),w=s(53563),q=s(49654),r=s(65536),K=s(5194),N=s(50612),ss=s(41909),ts=s(36481),os=s(54894),z=s(46725),as=s(28183),F=s(56740),es=s(87652),ms=s(15126),Cs=s(63299),Ts=s(67014),vs=s(59080),As=s(79275),Ls=s(14718),cs=s(82437),Is=s(61535),Bs=s(5790),Rs=s(12083),Us=s(35223),Ks=s(96854),fs=s(74930),xs=s(2600),ys=s(48940),js=s(41286),us=s(56336),Ss=s(13426),ps=s(84624),bs=s(77965),$s=s(54257),ks=s(71210),Ns=s(51187),zs=s(39404),Fs=s(58692),Gs=s(501),Js=s(57646),Qs=s(23120),Vs=s(44414),Ys=s(25962),Hs=s(14664),Xs=s(42588),Zs=s(90325),ws=s(62785),qs=s(87443),st=s(41032),tt=s(22957),ot=s(93179),at=s(73055),et=s(15747),nt=s(85306),_t=s(26509),it=s(32058),dt=s(81185),Et=s(82261);const ns=()=>{const[f,D]=P.useState(!1),[is,G]=P.useState(!1),[x,h]=P.useState([]),ds=(0,F.j)(a=>a.admin_app.permissions.settings?.webhooks),{formatMessage:e}=(0,os.A)(),{_unstableFormatAPIError:T}=(0,r.useAPIErrorHandler)(),O=(0,r.useNotification)();(0,r.useFocusWhenNavigate)();const{push:Es}=(0,z.W6)(),{pathname:J}=(0,z.zy)(),{isLoading:ls,allowedActions:{canCreate:y,canUpdate:j,canDelete:Q}}=(0,r.useRBAC)(ds),{notifyStatus:V}=(0,L.W)(),{isLoading:rs,webhooks:g,error:u,updateWebhook:Ms,deleteManyWebhooks:Ps}=(0,es.u)();P.useEffect(()=>{if(u){O({type:"warning",message:T(u)});return}g&&V(e({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[g,u,O,e,V,T]);const Ds=async a=>{try{const n=await Ms(a);"error"in n&&O({type:"warning",message:T(n.error)})}catch{O({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}},hs=async()=>{try{G(!0);const a=await Ps({ids:x});if("error"in a){O({type:"warning",message:T(a.error)});return}h([])}catch{O({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}finally{G(!1),D(!1)}},Os=a=>h(a?g?.map(n=>n.id)??[]:[]),gs=(a,n)=>h(a?b=>[...b,n]:b=>b.filter(Ws=>Ws!==n)),S=a=>()=>Es(`${J}/${a}`),p=ls||rs,v=g?.length??0,W=x.length;return(0,t.jsxs)(c.P,{children:[(0,t.jsx)(r.SettingsPageTitle,{name:"Webhooks"}),(0,t.jsxs)(I.g,{"aria-busy":p,children:[(0,t.jsx)(B.Q,{title:e({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:e({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:y&&!p&&(0,t.jsx)(q.z,{as:as.k2,startIcon:(0,t.jsx)(K.A,{}),variant:"default",to:`${J}/create`,size:"S",children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})}),W>0&&Q&&(0,t.jsx)(R.B,{startActions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.o,{variant:"epsilon",textColor:"neutral600",children:e({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:W})}),(0,t.jsx)(d.$,{onClick:()=>D(!0),startIcon:(0,t.jsx)(N.A,{}),size:"L",variant:"danger-light",children:e({id:"global.delete",defaultMessage:"Delete"})})]})}),(0,t.jsx)(o.s,{children:p?(0,t.jsx)(l.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(r.LoadingIndicatorPage,{})}):v>0?(0,t.jsxs)(i.X,{colCount:5,rowCount:v+1,footer:(0,t.jsx)(M.S,{onClick:S("create"),icon:(0,t.jsx)(K.A,{}),children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})}),children:[(0,t.jsx)(U.d,{children:(0,t.jsxs)(m.Tr,{children:[(0,t.jsx)(_.Th,{children:(0,t.jsx)(C.J,{"aria-label":e({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:W>0&&W<v,value:W===v,onValueChange:Os})}),(0,t.jsx)(_.Th,{width:"20%",children:(0,t.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:e({id:"global.name",defaultMessage:"Name"})})}),(0,t.jsx)(_.Th,{width:"60%",children:(0,t.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:e({id:"Settings.webhooks.form.url",defaultMessage:"URL"})})}),(0,t.jsx)(_.Th,{width:"20%",children:(0,t.jsx)(E.o,{variant:"sigma",textColor:"neutral600",children:e({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})})}),(0,t.jsx)(_.Th,{children:(0,t.jsx)(H.s,{children:e({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"})})})]})}),(0,t.jsx)(X.N,{children:g?.map(a=>(0,t.jsxs)(m.Tr,{onClick:j?S(a.id):void 0,style:{cursor:j?"pointer":"default"},children:[(0,t.jsx)(_.Td,{onClick:n=>n.stopPropagation(),children:(0,t.jsx)(C.J,{"aria-label":`${e({id:"global.select",defaultMessage:"Select"})} ${a.name}`,value:x?.includes(a.id),onValueChange:n=>gs(n,a.id),name:"select"})}),(0,t.jsx)(_.Td,{children:(0,t.jsx)(E.o,{fontWeight:"semiBold",textColor:"neutral800",children:a.name})}),(0,t.jsx)(_.Td,{children:(0,t.jsx)(E.o,{textColor:"neutral800",children:a.url})}),(0,t.jsx)(_.Td,{children:(0,t.jsx)($.s,{children:(0,t.jsx)(Z.d,{onLabel:e({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:e({id:"global.disabled",defaultMessage:"Disabled"}),label:`${a.name} ${e({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:a.isEnabled,onChange:n=>{n.stopPropagation(),Ds({...a,isEnabled:!a.isEnabled})},visibleLabels:!0})})}),(0,t.jsx)(_.Td,{children:(0,t.jsxs)($.s,{gap:1,children:[j&&(0,t.jsx)(k.K,{label:e({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:(0,t.jsx)(ss.A,{}),noBorder:!0}),Q&&(0,t.jsx)(k.K,{onClick:n=>{n.stopPropagation(),h([a.id]),D(!0)},label:e({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),icon:(0,t.jsx)(N.A,{}),noBorder:!0})]})})]},a.id))})]}):(0,t.jsx)(w.p,{icon:(0,t.jsx)(ts.A,{width:"160px"}),content:e({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:(0,t.jsx)(d.$,{variant:"secondary",startIcon:(0,t.jsx)(K.A,{}),disabled:!y,onClick:y?S("create"):void 0,children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})})})]}),(0,t.jsx)(r.ConfirmDialog,{isOpen:f,onToggleDialog:()=>D(a=>!a),onConfirm:hs,isConfirmButtonLoading:is})]})},_s=()=>{const f=(0,F.j)(D=>D.admin_app.permissions.settings?.webhooks.main);return(0,t.jsx)(r.CheckPagePermissions,{permissions:f,children:(0,t.jsx)(ns,{})})}},87652:(Y,A,s)=>{s.d(A,{u:()=>E});var t=s(56740);const P=t.n.injectEndpoints({endpoints:d=>({getWebhooks:d.query({query:o=>({url:`/admin/webhooks/${o?.id??""}`,method:"GET"}),transformResponse:o=>Array.isArray(o.data)?o.data:[o.data],providesTags:(o,l,i)=>typeof i=="object"&&"id"in i?[{type:"Webhook",id:i.id}]:[...o?.map(({id:M})=>({type:"Webhook",id:M}))??[],{type:"Webhook",id:"LIST"}]}),createWebhook:d.mutation({query:o=>({url:"/admin/webhooks",method:"POST",data:o}),transformResponse:o=>o.data,invalidatesTags:[{type:"Webhook",id:"LIST"}]}),updateWebhook:d.mutation({query:({id:o,...l})=>({url:`/admin/webhooks/${o}`,method:"PUT",data:l}),transformResponse:o=>o.data,invalidatesTags:(o,l,{id:i})=>[{type:"Webhook",id:i}]}),triggerWebhook:d.mutation({query:o=>({url:`/admin/webhooks/${o}/trigger`,method:"POST"}),transformResponse:o=>o.data}),deleteManyWebhooks:d.mutation({query:o=>({url:"/admin/webhooks/batch-delete",method:"POST",data:o}),transformResponse:o=>o.data,invalidatesTags:(o,l,{ids:i})=>i.map(M=>({type:"Webhook",id:M}))})}),overrideExisting:!1}),{useGetWebhooksQuery:L,useCreateWebhookMutation:c,useUpdateWebhookMutation:I,useTriggerWebhookMutation:B,useDeleteManyWebhooksMutation:R}=P,E=(d=void 0,o)=>{const{data:l,isLoading:i,error:M}=L(d,o),[U]=c(),[m]=I(),[_]=B(),[C]=R();return{webhooks:l,isLoading:i,error:M,createWebhook:U,updateWebhook:m,triggerWebhook:_,deleteManyWebhooks:C}}}}]);
