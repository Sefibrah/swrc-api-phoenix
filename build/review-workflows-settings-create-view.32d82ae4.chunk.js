"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[8936],{36318:(ve,I,t)=>{t.r(I),t.d(I,{default:()=>ne});var e=t(67294),c=t(32638),f=t(86706),Y=t(36364),Z=t(12473),p=t(96987),B=t(74863),R=t(71068),H=t(18226),E=t(41054),N=t(36968),j=t.n(N),J=t(86896),U=t(88767),$=t(16550),G=t(98374),K=t(92686),Q=t(79194),b=t(75021),g=t(11984),m=t(43390),u=t(38705),q=t(68997),_=t(85230),n=t(86978),ee=t(52258),te=t(3848),w=t(65649),se=t(66578);function oe(){const{formatMessage:o}=(0,J.Z)(),{post:ae}=(0,c.useFetchClient)(),{push:le}=(0,$.k6)(),{formatAPIError:re}=(0,c.useAPIErrorHandler)(),i=(0,f.I0)(),v=(0,c.useNotification)(),{collectionTypes:W,singleTypes:A,isLoading:k}=(0,K.G)(),{isLoading:h,meta:C,workflows:S}=(0,ee.n)(),{isLoading:L,roles:D}=(0,G.F)(void 0,{retry:!1}),y=(0,f.v9)(w.xU),ie=(0,f.v9)(w.bH),l=(0,f.v9)(w.DV),P=(0,f.v9)(w.g$),[F,d]=e.useState(!1),{isLoading:x,getFeature:ce}=(0,b.q)(),[fe,ge]=e.useState(null),[V,T]=e.useState({}),a=ce("review-workflows"),O=S.flatMap(s=>s.contentTypes),{mutateAsync:ue,isLoading:de}=(0,U.useMutation)(async({workflow:s})=>{const{data:{data:r}}=await ae("/admin/review-workflows/workflows",{data:s});return r},{onSuccess(){v({type:"success",message:{id:"Settings.review-workflows.create.page.notification.success",defaultMessage:"Workflow successfully created"}})}}),z=async()=>{T({});try{const s=await ue({workflow:l});return le(`/settings/review-workflows/${s.id}`),s}catch(s){return s.response.data?.error?.name==="ValidationError"&&s.response.data?.error?.details?.errors?.length>0&&ge(s.response.data?.error?.details?.errors.reduce((r,X)=>(j()(r,X.path,X.message),r),{})),v({type:"warning",message:re(s)}),null}},me=async()=>{await z()},we=()=>{T({})},M=(0,E.TA)({enableReinitialize:!0,initialErrors:fe,initialValues:l,async onSubmit(){const s=l.contentTypes.some(r=>O.includes(r));a?.[n.Ef]&&C?.workflowCount>=parseInt(a[n.Ef],10)?d("workflow"):a?.[n._X]&&l.stages.length>=parseInt(a[n._X],10)?d("stage"):s?T(r=>({...r,hasReassignedContentTypes:!0})):z()},validate(s){return(0,se.V)({values:s,formatMessage:o})}});return(0,Q.v)(n.sN,te.I),e.useEffect(()=>{i((0,g.Js)()),h||i((0,g.PP)({workflows:S})),k||i((0,g.Pz)({collectionTypes:W,singleTypes:A})),L||i((0,g.Lk)(D)),i((0,g.wt)(k||L)),i((0,g.CI)({name:""}))},[W,i,k,L,h,D,A,S]),e.useEffect(()=>{!h&&!x&&(a?.[n.Ef]&&C?.workflowsTotal>=parseInt(a[n.Ef],10)?d("workflow"):a?.[n._X]&&l.stages.length>=parseInt(a[n._X],10)&&d("stage"))},[x,h,a,C?.workflowsTotal,l.stages.length]),e.useEffect(()=>{!y&&P.length===0&&v({blockTransition:!0,type:"warning",message:o({id:"Settings.review-workflows.stage.permissions.noPermissions.description",defaultMessage:"You don\u2019t have the permission to see roles"})})},[o,y,P,v]),e.createElement(e.Fragment,null,e.createElement(m.lx,null),e.createElement(E.Hy,{value:M},e.createElement(E.l0,{onSubmit:M.handleSubmit},e.createElement(m.h4,{navigationAction:e.createElement(m.eJ,{href:"/settings/review-workflows"}),primaryAction:e.createElement(Z.z,{startIcon:e.createElement(H.Z,null),type:"submit",size:"M",disabled:!ie,isLoading:de},o({id:"global.save",defaultMessage:"Save"})),title:o({id:"Settings.review-workflows.create.page.title",defaultMessage:"Create Review Workflow"}),subtitle:o({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:l?.stages?.length??0})}),e.createElement(m.fC,null,e.createElement(p.k,{alignItems:"stretch",direction:"column",gap:7},y?e.createElement(B.a,null,o({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})):e.createElement(p.k,{alignItems:"stretch",direction:"column",gap:7},e.createElement(_.Y,null),e.createElement(q.U,{stages:M.values?.stages})))))),e.createElement(c.ConfirmDialog.Root,{isConfirmButtonLoading:y,isOpen:Object.keys(V).length>0,onToggleDialog:we,onConfirm:me},e.createElement(c.ConfirmDialog.Body,null,e.createElement(p.k,{direction:"column",gap:5},V.hasReassignedContentTypes&&e.createElement(R.Z,{textAlign:"center",variant:"omega"},o({id:"Settings.review-workflows.page.delete.confirm.contentType.body",defaultMessage:"{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed."},{count:O.filter(s=>l.contentTypes.includes(s)).length})),e.createElement(R.Z,{textAlign:"center",variant:"omega"},o({id:"Settings.review-workflows.page.delete.confirm.confirm",defaultMessage:"Are you sure you want to save?"}))))),e.createElement(u.fC,{isOpen:F==="workflow",onClose:()=>d(!1)},e.createElement(u.Dx,null,o({id:"Settings.review-workflows.create.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})),e.createElement(u.uT,null,o({id:"Settings.review-workflows.create.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."}))),e.createElement(u.fC,{isOpen:F==="stage",onClose:()=>d(!1)},e.createElement(u.Dx,null,o({id:"Settings.review-workflows.create.page.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})),e.createElement(u.uT,null,o({id:"Settings.review-workflows.create.page.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."}))))}function ne(){const o=(0,f.v9)(Y._);return e.createElement(c.CheckPagePermissions,{permissions:o.settings["review-workflows"].create},e.createElement(oe,null))}}}]);
