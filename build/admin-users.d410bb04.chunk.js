"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[5199],{32739:(F,c,e)=>{e.d(c,{R:()=>m});var t=e(67294),u=e(32638),i=e(88767);function m(v={},a={}){const{id:s="",...E}=v,{get:g}=(0,u.useFetchClient)(),{data:n,isError:C,isLoading:D,refetch:R}=(0,i.useQuery)(["users",s,E],async()=>{const{data:{data:d}}=await g(`/admin/users/${s}`,{params:E});return d},a);return{users:t.useMemo(()=>{let d=[];return n&&("results"in n?Array.isArray(n.results)&&(d=n.results):d=[n]),d},[n]),pagination:t.useMemo(()=>(n&&"pagination"in n)??null,[n]),isLoading:D,isError:C,refetch:R}}},71359:(F,c,e)=>{e.d(c,{Z:()=>n});var t=e(67294),u=e(16607),i=e(12473),m=e(32638),v=e(52933),a=e(45697),s=e.n(a),E=e(86896);const g=({displayedFilters:C})=>{const[D,R]=(0,t.useState)(!1),{formatMessage:y}=(0,E.Z)(),d=(0,t.useRef)(),S=()=>{R(A=>!A)};return t.createElement(t.Fragment,null,t.createElement(u.x,{paddingTop:1,paddingBottom:1},t.createElement(i.z,{variant:"tertiary",ref:d,startIcon:t.createElement(v.Z,null),onClick:S,size:"S"},y({id:"app.utils.filters",defaultMessage:"Filters"})),D&&t.createElement(m.FilterPopoverURLQuery,{displayedFilters:C,isVisible:D,onToggle:S,source:d})),t.createElement(m.FilterListURLQuery,{filtersSchema:C}))};g.propTypes={displayedFilters:s().arrayOf(s().shape({name:s().string.isRequired,metadatas:s().shape({label:s().string}),fieldSchema:s().shape({type:s().string})})).isRequired};const n=g},61611:(F,c,e)=>{e.d(c,{W:()=>pe,Z:()=>Ze});var t=e(67294),u=e(40720),i=e(90731),m=e(55040),v=e(34726),a=e(32638),s=e(36232),E=e.n(s),g=e(86896),n=e(88767),C=e(86706),D=e(16550),R=e(32739),y=e(48232),d=e(36364),S=e(71359),A=e(12473),Z=e(24116),se=e(45697),o=e.n(se);const q=({onClick:l})=>{const{formatMessage:M}=(0,g.Z)();return t.createElement(A.z,{onClick:l,startIcon:t.createElement(Z.Z,null),size:"S"},M({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}))};q.propTypes={onClick:o().func.isRequired};var ne=e(35752),x=e(29299),G=e(69398),le=e(12803),b=e(71068),z=e(96987),ee=e(96208),p=e(16607),Me=e(2382),fe=e(54425),re=e(96854);const oe=({canDelete:l,headers:M,entriesToDelete:L,onClickDelete:k,onSelectRow:$,withMainAction:N,withBulkActions:W,rows:U})=>{const{push:h,location:{pathname:H}}=(0,D.k6)(),{formatMessage:O}=(0,g.Z)();return t.createElement(ne.p,null,U.map(r=>{const Q=L.findIndex(I=>I===r.id)!==-1;return t.createElement(x.Tr,{key:r.id,...(0,a.onRowClick)({fn:()=>h(`${H}/${r.id}`),condition:W})},N&&t.createElement(G.Td,{...a.stopPropagation},t.createElement(le.C,{"aria-label":O({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,re.Pp)(r.firstname,r.lastname)}),checked:Q,onChange:()=>{$({name:r.id,value:!Q})}})),M.map(({key:I,cellFormatter:V,name:K,...j})=>t.createElement(G.Td,{key:I},typeof V=="function"?V(r,{key:I,name:K,formatMessage:O,...j}):t.createElement(b.Z,{textColor:"neutral800"},r[K]||"-"))),W&&t.createElement(G.Td,null,t.createElement(z.k,{justifyContent:"end"},t.createElement(ee.h,{onClick:()=>h(`${H}/${r.id}`),label:O({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,re.Pp)(r.firstname,r.lastname)}),noBorder:!0,icon:t.createElement(Me.Z,null)}),l&&t.createElement(p.x,{paddingLeft:1,...a.stopPropagation},t.createElement(ee.h,{onClick:()=>k(r.id),label:O({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,re.Pp)(r.firstname,r.lastname)}),noBorder:!0,icon:t.createElement(fe.Z,null)})))))}))};oe.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},oe.propTypes={canDelete:o().bool,entriesToDelete:o().array,headers:o().array.isRequired,onClickDelete:o().func,onSelectRow:o().func,rows:o().array,withBulkActions:o().bool,withMainAction:o().bool};const Pe=oe;var ve=e(74622),ye=e(36854),he=e(71543),de=e(31988),ie=e(6498),Ce=e(37022),De=e(82392),Ae=e(75071),Oe=e(41054),Le=e(30164),Te=e(85078),J=e(87561);const ue={firstname:"",lastname:"",email:"",roles:[]},Re=[],Ue=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Ie=J.Ry().shape({firstname:J.Z_().trim().required(a.translatedErrors.required),lastname:J.Z_(),email:J.Z_().email(a.translatedErrors.email).required(a.translatedErrors.required),roles:J.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)}),Be={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Ee=({onSuccess:l,onToggle:M})=>{const[L,k]=(0,t.useState)("create"),[$,N]=(0,t.useState)(!1),[W,U]=(0,t.useState)(null),{formatMessage:h}=(0,g.Z)(),H=(0,a.useNotification)(),{lockApp:O,unlockApp:r}=(0,a.useOverlayBlocker)(),{post:Q}=(0,a.useFetchClient)(),I=(0,y.c)(Re,async()=>(await e.e(9329).then(e.bind(e,99329))).ROLE_LAYOUT,{combine(P,B){return[...P,B]},defaultValue:[]}),V=(0,y.c)(ue,async()=>(await e.e(9329).then(e.bind(e,99329))).FORM_INITIAL_VALUES,{combine(P,B){return{...P,...B}},defaultValue:ue}),K=(0,y.c)(Le.A,async()=>(await e.e(566).then(e.bind(e,20566))).MagicLinkEE),j=(0,n.useMutation)(P=>Q("/admin/users",P),{async onSuccess({data:P}){U(P.data.registrationToken),await l(),ae(),N(!1)},onError(P){throw N(!1),H({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),P},onSettled(){r()}}),w=h({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),te=async(P,{setErrors:B})=>{O(),N(!0);try{await j.mutateAsync(P)}catch(Y){r(),Y?.response?.data?.error.message==="Email already taken"&&B({email:Y.response.data.error.message})}},ae=()=>{f?k(f):M()},{buttonSubmitLabel:_,isDisabled:X,next:f}=Be[L],xe=L==="create"?t.createElement(A.z,{type:"submit",loading:$},h(_)):t.createElement(A.z,{type:"button",loading:$,onClick:M},h(_));return K?t.createElement(ve.P,{onClose:M,labelledBy:"title"},t.createElement(ye.x,null,t.createElement(De.O,{label:w},t.createElement(Ae.$,{isCurrent:!0},w))),t.createElement(Oe.J9,{enableReinitialize:!0,initialValues:V,onSubmit:te,validationSchema:Ie,validateOnChange:!1},({errors:P,handleChange:B,values:Y})=>t.createElement(a.Form,null,t.createElement(he.f,null,t.createElement(z.k,{direction:"column",alignItems:"stretch",gap:6},L!=="create"&&t.createElement(K,{registrationToken:W}),t.createElement(p.x,null,t.createElement(b.Z,{variant:"beta",as:"h2"},h({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),t.createElement(p.x,{paddingTop:4},t.createElement(z.k,{direction:"column",alignItems:"stretch",gap:1},t.createElement(de.r,{gap:5},Ue.map(me=>me.map(T=>t.createElement(ie.P,{key:T.name,...T.size},t.createElement(a.GenericInput,{...T,disabled:X,error:P[T.name],onChange:B,value:Y[T.name]})))))))),t.createElement(p.x,null,t.createElement(b.Z,{variant:"beta",as:"h2"},h({id:"global.roles",defaultMessage:"User's role"})),t.createElement(p.x,{paddingTop:4},t.createElement(de.r,{gap:5},t.createElement(ie.P,{col:6,xs:12},t.createElement(Te.Z,{disabled:X,error:P.roles,onChange:B,value:Y.roles})),I.map(me=>me.map(T=>t.createElement(ie.P,{key:T.name,...T.size},t.createElement(a.GenericInput,{...T,disabled:X,onChange:B,value:Y[T.name]}))))))))),t.createElement(Ce.m,{startActions:t.createElement(A.z,{variant:"tertiary",onClick:M,type:"button"},h({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:xe})))):null};Ee.propTypes={onToggle:o().func.isRequired,onSuccess:o().func.isRequired};const Se=Ee,ce=({pagination:l})=>t.createElement(p.x,{paddingTop:4},t.createElement(z.k,{alignItems:"flex-end",justifyContent:"space-between"},t.createElement(a.PageSizeURLQuery,null),t.createElement(a.PaginationURLQuery,{pagination:l})));ce.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},ce.propTypes={pagination:o().shape({page:o().number,pageCount:o().number,pageSize:o().number,total:o().number})};const We=ce,Ke=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Fe=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:l},{formatMessage:M}){return t.createElement(b.Z,{textColor:"neutral800"},l.map(L=>M({id:`Settings.permissions.users.${L.code}`,defaultMessage:L.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:l},{formatMessage:M}){return t.createElement(z.k,null,t.createElement(a.Status,{isActive:l,variant:l?"success":"danger"}),t.createElement(b.Z,{textColor:"neutral800"},M({id:l?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:l?"Active":"Inactive"})))}}],ge=["ee","license-limit-info"],pe=()=>{const{post:l}=(0,a.useFetchClient)(),{formatAPIError:M}=(0,a.useAPIErrorHandler)(),[L,k]=(0,t.useState)(!1),$=(0,C.v9)(d._),{allowedActions:{canCreate:N,canDelete:W,canRead:U}}=(0,a.useRBAC)($.settings.users),h=(0,n.useQueryClient)(),H=(0,a.useNotification)(),{formatMessage:O}=(0,g.Z)(),{search:r}=(0,D.TH)();(0,a.useFocusWhenNavigate)();const{users:Q,pagination:I,isError:V,isLoading:K,refetch:j}=(0,R.R)(E().parse(r,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:U}),w=(0,y.c)(q,async()=>(await e.e(5833).then(e.bind(e,85833))).CreateActionEE),te=Fe.map(f=>({...f,metadatas:{...f.metadatas,label:O(f.metadatas.label)}})),ae=O({id:"global.users",defaultMessage:"Users"}),_=()=>{k(f=>!f)},X=(0,n.useMutation)(async f=>{await l("/admin/users/batch-delete",{ids:f})},{async onSuccess(){await j(),await h.refetchQueries(ge)},onError(f){H({type:"warning",message:{id:"notification.error",message:M(f),defaultMessage:"An error occured"}})}});return w?t.createElement(u.o,{"aria-busy":K},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(i.T,{primaryAction:N&&t.createElement(w,{onClick:_}),title:ae,subtitle:O({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),U&&t.createElement(m.Z,{startActions:t.createElement(t.Fragment,null,t.createElement(a.SearchURLQuery,{label:O({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ae})}),t.createElement(S.Z,{displayedFilters:Ke}))}),t.createElement(v.D,{canRead:U},!U&&t.createElement(a.NoPermissions,null),V&&t.createElement("div",null,"TODO: An error occurred"),U&&t.createElement(t.Fragment,null,t.createElement(a.DynamicTable,{contentType:"Users",isLoading:K,onConfirmDeleteAll:X.mutateAsync,onConfirmDelete:f=>X.mutateAsync([f]),headers:te,rows:Q,withBulkActions:!0,withMainAction:W},t.createElement(Pe,{canDelete:W,headers:te,rows:Q,withBulkActions:!0,withMainAction:W})),I&&t.createElement(We,{pagination:I}))),L&&t.createElement(Se,{onSuccess:async()=>{await j(),await h.refetchQueries(ge)},onToggle:_})):null},Ze=()=>{const l=(0,y.c)(pe,async()=>(await e.e(5481).then(e.bind(e,17403))).UserListPageEE);return l?t.createElement(l,null):null}},87901:(F,c,e)=>{e.r(c),e.d(c,{default:()=>s});var t=e(67294),u=e(32638),i=e(86706),m=e(36364),v=e(61611);const s=()=>{const E=(0,i.v9)(m._);return t.createElement(u.CheckPagePermissions,{permissions:E.settings.users.main},t.createElement(v.Z,null))}},6324:(F,c,e)=>{e.d(c,{Z:()=>g});var t=e(67294),u=e(96208),i=e(32638),m=e(43838),v=e(45697),a=e.n(v),s=e(86896);const E=({children:n,target:C})=>{const D=(0,i.useNotification)(),{formatMessage:R}=(0,s.Z)(),{copy:y}=(0,i.useClipboard)(),d=R({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),S=async()=>{await y(C)&&D({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(i.ContentBox,{endAction:t.createElement(u.h,{label:d,noBorder:!0,icon:t.createElement(m.Z,null),onClick:S}),title:C,titleEllipsis:!0,subtitle:n,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};E.propTypes={children:a().oneOfType([a().element,a().string]).isRequired,target:a().string.isRequired};const g=E},30164:(F,c,e)=>{e.d(c,{A:()=>s});var t=e(67294),u=e(45697),i=e.n(u),m=e(86896),v=e(95651),a=e(6324);const s=({registrationToken:E})=>{const{formatMessage:g}=(0,m.Z)(),n=`${window.location.origin}${v.Z}auth/register?registrationToken=${E}`;return t.createElement(a.Z,{target:n},g({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:i().string}},85078:(F,c,e)=>{e.d(c,{Z:()=>S});var t=e(67294),u=e(59586),i=e(40933),m=e(32638),v=e(2),a=e(45697),s=e.n(a),E=e(86896),g=e(88767),n=e(71997);const C=(0,n.F4)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,D=n.ZP.div`
  animation: ${C} 2s infinite linear;
`,R=()=>t.createElement(D,null,t.createElement(v.Z,null)),y=async()=>{const{get:A}=(0,m.getFetchClient)(),{data:Z}=await A("/admin/roles");return Z.data},d=({disabled:A,error:Z,onChange:se,value:o})=>{const{status:q,data:ne}=(0,g.useQuery)(["roles"],y,{staleTime:5e4}),{formatMessage:x}=(0,E.Z)(),G=Z?x({id:Z,defaultMessage:Z}):"",le=x({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),b=x({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),z=x({id:"app.components.Select.placeholder",defaultMessage:"Select"}),ee=q==="loading"?t.createElement(R,null):void 0;return t.createElement(u.P,{id:"roles",disabled:A,error:G,hint:b,label:le,name:"roles",onChange:p=>{se({target:{name:"roles",value:p}})},placeholder:z,multi:!0,startIcon:ee,value:o.map(p=>p.toString()),withTags:!0,required:!0},(ne||[]).map(p=>t.createElement(i.W,{key:p.id,value:p.id.toString()},x({id:`global.${p.code}`,defaultMessage:p.name}))))};d.defaultProps={disabled:!1,error:void 0},d.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const S=d},24116:(F,c,e)=>{e.d(c,{Z:()=>i});var t=e(85893);const u=m=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...m,children:[(0,t.jsx)("path",{fill:"#32324D",d:"M0 2.8A.8.8 0 0 1 .8 2h22.4a.8.8 0 0 1 .8.8v2.71a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2.8Z"}),(0,t.jsx)("path",{fill:"#32324D",d:"M1.922 7.991C.197 6.675 0 6.252 0 5.289h23.953c.305 1.363-1.594 2.506-2.297 3.125-1.953 1.363-6.253 4.36-7.828 5.45-1.575 1.09-3.031.455-3.562 0-2.063-1.41-6.62-4.557-8.344-5.873ZM22.8 18H1.2c-.663 0-1.2.471-1.2 1.053v1.894C0 21.529.537 22 1.2 22h21.6c.663 0 1.2-.471 1.2-1.053v-1.894c0-.582-.537-1.053-1.2-1.053Z"}),(0,t.jsx)("path",{fill:"#32324D",d:"M0 9.555v10.972h24V9.554c-2.633 1.95-8.367 6.113-9.96 7.166-1.595 1.052-3.352.438-4.032 0L0 9.555Z"})]}),i=u}}]);
