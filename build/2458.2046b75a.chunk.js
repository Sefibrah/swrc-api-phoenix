(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[2458],{3414:(f,g,e)=>{"use strict";e.d(g,{Z:()=>O});var t=e(67294),p=e(90731),r=e(96987),o=e(12473),s=e(32638),i=e(18226),u=e(97695),T=e(45697),a=e.n(T),v=e(86896),A=e(75975),n=e(29204);const C=(I,k,X,L)=>{const[D,K]=(0,t.useState)(!1),B=(0,s.useNotification)(),{post:G}=(0,s.useFetchClient)(),{formatAPIError:Y}=(0,s.useAPIErrorHandler)();return{regenerateData:async()=>{try{const{data:{data:{accessKey:H}}}=await G(`${I}${k}/regenerate`);K(!1),X(H)}catch(H){K(!1),L?L(H):H instanceof n.d7&&B({type:"warning",message:Y(H)})}},isLoadingConfirmation:D}},P=({onRegenerate:I,idToRegenerate:k,backUrl:X,onError:L})=>{const{formatMessage:D}=(0,v.Z)(),[K,B]=(0,t.useState)(!1),{regenerateData:G,isLoadingConfirmation:Y}=C(X,k,I,L),z=async()=>{G(),B(!1)};return t.createElement(t.Fragment,null,t.createElement(o.z,{startIcon:t.createElement(A.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>B(!0),name:"regenerate"},D({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(s.ConfirmDialog,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(A.Z,null),isConfirmButtonLoading:Y,isOpen:K,onToggleDialog:()=>B(!1),onConfirm:z,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};P.defaultProps={onRegenerate(){},onError:void 0},P.propTypes={onRegenerate:a().func,idToRegenerate:a().oneOfType([a().number,a().string]).isRequired,backUrl:a().string.isRequired,onError:a().func};const M=P,h=({title:I,token:k,setToken:X,canEditInputs:L,canRegenerate:D,isSubmitting:K,backUrl:B,regenerateUrl:G,onErrorRegenerate:Y})=>{const{formatMessage:z}=(0,v.Z)(),H=Q=>{X({...k,accessKey:Q})};return t.createElement(p.T,{title:k?.name||z(I),primaryAction:L?t.createElement(r.k,{gap:2},D&&k?.id&&t.createElement(M,{backUrl:G,onRegenerate:H,idToRegenerate:k?.id,onError:Y}),t.createElement(o.z,{disabled:K,loading:K,startIcon:t.createElement(i.Z,null),type:"submit",size:"S"},z({id:"global.save",defaultMessage:"Save"}))):D&&k?.id&&t.createElement(M,{onRegenerate:H,idToRegenerate:k?.id,backUrl:G}),navigationAction:t.createElement(s.Link,{startIcon:t.createElement(u.Z,null),to:B},z({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};h.propTypes={token:a().shape({id:a().oneOfType([a().number,a().string]),type:a().string,lifespan:a().oneOfType([a().number,a().string]),name:a().string,accessKey:a().string,permissions:a().array,description:a().string,createdAt:a().string}),canEditInputs:a().bool.isRequired,canRegenerate:a().bool.isRequired,setToken:a().func.isRequired,isSubmitting:a().bool.isRequired,backUrl:a().string.isRequired,title:a().shape({id:a().string,label:a().string}).isRequired,regenerateUrl:a().string.isRequired,onErrorRegenerate:a().func},h.defaultProps={token:void 0,onErrorRegenerate:void 0};const O=h},89982:(f,g,e)=>{"use strict";e.d(g,{Z:()=>v});var t=e(67294),p=e(59586),r=e(40933),o=e(71068),s=e(45697),i=e.n(s),u=e(86896),T=e(51352);const a=({token:A,errors:n,values:C,onChange:P,isCreating:M})=>{const{formatMessage:h}=(0,u.Z)();return t.createElement(t.Fragment,null,t.createElement(p.P,{name:"lifespan",label:h({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:C.lifespan!==null?C.lifespan:"0",error:n.lifespan?h(n.lifespan?.id?n.lifespan:{id:n.lifespan,defaultMessage:n.lifespan}):null,onChange:O=>{P({target:{name:"lifespan",value:O}})},required:!0,disabled:!M,placeholder:"Select"},t.createElement(r.W,{value:"604800000"},h({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(r.W,{value:"2592000000"},h({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(r.W,{value:"7776000000"},h({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(r.W,{value:"0"},h({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(o.Z,{variant:"pi",textColor:"neutral600"},!M&&`${h({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,T.IX)(A?.createdAt,parseInt(C.lifespan,10))}`))};a.propTypes={errors:i().shape({lifespan:i().string}),onChange:i().func.isRequired,values:i().shape({lifespan:i().oneOfType([i().number,i().string])}).isRequired,isCreating:i().bool.isRequired,token:i().shape({id:i().oneOfType([i().number,i().string]),type:i().string,lifespan:i().string,name:i().string,accessKey:i().string,permissions:i().array,description:i().string,createdAt:i().string})},a.defaultProps={errors:{},token:{}};const v=a},81384:(f,g,e)=>{"use strict";e.d(g,{Z:()=>v});var t=e(67294),p=e(96208),r=e(32638),o=e(43838),s=e(46374),i=e(45697),u=e.n(i),T=e(86896);const a=({token:A,tokenType:n})=>{const{formatMessage:C}=(0,T.Z)(),P=(0,r.useNotification)(),{trackUsage:M}=(0,r.useTracking)(),{copy:h}=(0,r.useClipboard)(),O=I=>async()=>{await h(I)&&(M("didCopyTokenKey",{tokenType:n}),P({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(r.ContentBox,{endAction:A&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(p.h,{label:C({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:O(A),noBorder:!0,icon:t.createElement(o.Z,null),style:{padding:0,height:"1rem"}})),title:A||C({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:C(A?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(s.Z,null),iconBackground:"neutral100"})};a.defaultProps={token:null},a.propTypes={token:u().string,tokenType:u().string.isRequired};const v=a},37651:(f,g,e)=>{"use strict";e.d(g,{Z:()=>u});var t=e(67294),p=e(457),r=e(45697),o=e.n(r),s=e(86896);const i=({errors:T,values:a,onChange:v,canEditInputs:A})=>{const{formatMessage:n}=(0,s.Z)();return t.createElement(p.g,{label:n({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:T.description?n(T.description?.id?T.description:{id:T.description,defaultMessage:T.description}):null,onChange:v,disabled:!A},a.description)};i.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},i.defaultProps={errors:{}};const u=i},72028:(f,g,e)=>{"use strict";e.d(g,{Z:()=>u});var t=e(67294),p=e(38670),r=e(45697),o=e.n(r),s=e(86896);const i=({errors:T,values:a,onChange:v,canEditInputs:A})=>{const{formatMessage:n}=(0,s.Z)();return t.createElement(p.o,{name:"name",error:T.name?n(T.name?.id?T.name:{id:T.name,defaultMessage:T.name}):null,label:n({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:v,value:a.name,disabled:!A,required:!0})};i.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},i.defaultProps={errors:{}};const u=i},32381:(f,g,e)=>{"use strict";e.d(g,{Z:()=>T});var t=e(67294),p=e(59586),r=e(40933),o=e(45697),s=e.n(o),i=e(86896);const u=({name:a,errors:v,values:A,onChange:n,canEditInputs:C,options:P,label:M})=>{const{formatMessage:h}=(0,i.Z)();return t.createElement(p.P,{name:a,label:h({id:M.id,defaultMessage:M.defaultMessage}),value:A&&A[a],error:v[a]?h(v[a]?.id?v[a]:{id:v[a],defaultMessage:v[a]}):null,onChange:n,placeholder:"Select",required:!0,disabled:!C},P&&P.map(({value:O,label:I})=>t.createElement(r.W,{key:O,value:O},h(I))))};u.propTypes={name:s().string,options:s().arrayOf(s().shape({label:s().shape({id:s().string,defaultMessage:s().string}),value:s().string})),errors:s().shape({type:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({type:s().string}).isRequired,label:s().shape({id:s().string,defaultMessage:s().string}).isRequired},u.defaultProps={name:"type",errors:{},options:[]};const T=u},81966:(f,g,e)=>{"use strict";e.d(g,{Z:()=>t,f:()=>p});const t="api-token",p="transfer-token"},92458:(f,g,e)=>{"use strict";e.d(g,{Z:()=>Xe});var t=e(67294),p=e(40720),r=e(34726),o=e(96987),s=e(32638),i=e(41054),u=e(86896),T=e(88767),a=e(86706),v=e(16550),A=e(45697),n=e.n(A);const C=(0,t.createContext)({}),P=({children:l,...c})=>t.createElement(C.Provider,{value:c},l),M=()=>(0,t.useContext)(C);P.propTypes={children:n().node.isRequired};var h=e(96854),O=e(36364),I=e(81966),k=e(3414),X=e(81384),L=e(16607),D=e(71068),K=e(31988),B=e(6498),G=e(89982),Y=e(37651),z=e(72028),H=e(32381);const Q=({errors:l,onChange:c,canEditInputs:d,isCreating:R,values:E,apiToken:x,onDispatch:y,setHasChangedPermissions:V})=>{const{formatMessage:b}=(0,u.Z)(),F=({target:{value:$}})=>{V(!1),$==="full-access"&&y({type:"SELECT_ALL_ACTIONS"}),$==="read-only"&&y({type:"ON_CHANGE_READ_ONLY"})},J=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return t.createElement(L.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(D.Z,{variant:"delta",as:"h2"},b({id:"global.details",defaultMessage:"Details"})),t.createElement(K.r,{gap:5},t.createElement(B.P,{key:"name",col:6,xs:12},t.createElement(z.Z,{errors:l,values:E,canEditInputs:d,onChange:c})),t.createElement(B.P,{key:"description",col:6,xs:12},t.createElement(Y.Z,{errors:l,values:E,canEditInputs:d,onChange:c})),t.createElement(B.P,{key:"lifespan",col:6,xs:12},t.createElement(G.Z,{isCreating:R,errors:l,values:E,onChange:c,token:x})),t.createElement(B.P,{key:"type",col:6,xs:12},t.createElement(H.Z,{values:E,errors:l,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:$=>{F({target:{value:$}}),c({target:{name:"type",value:$}})},options:J,canEditInputs:d})))))};Q.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},Q.defaultProps={errors:{},apiToken:{}};const Ee=Q;var fe=e(90731),ye=e(12473),Te=e(18226);const ne=({apiTokenName:l})=>{const{formatMessage:c}=(0,u.Z)();return(0,s.useFocusWhenNavigate)(),t.createElement(p.o,{"aria-busy":"true"},t.createElement(s.SettingsPageTitle,{name:"API Tokens"}),t.createElement(fe.T,{primaryAction:t.createElement(ye.z,{disabled:!0,startIcon:t.createElement(Te.Z,null),type:"button",size:"L"},c({id:"global.save",defaultMessage:"Save"})),title:l||c({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),t.createElement(r.D,null,t.createElement(s.LoadingIndicatorPage,null)))};ne.defaultProps={apiTokenName:null},ne.propTypes={apiTokenName:n().string};const he=ne;var ve=e(35161),Ae=e.n(ve),Ce=e(13217),Pe=e.n(Ce),ee=e(71997);const Me=l=>{switch(l){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Re=(0,ee.ZP)(L.x)`
  margin: -1px;
  border-radius: ${({theme:l})=>l.spaces[1]} 0 0 ${({theme:l})=>l.spaces[1]};
`;function se({route:l}){const{formatMessage:c}=(0,u.Z)(),{method:d,handler:R,path:E}=l,x=E?Pe()(E.split("/")):[],[y="",V=""]=R?R.split("."):[],b=Me(l.method);return t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(D.Z,{variant:"delta",as:"h3"},c({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",t.createElement("span",null,y),t.createElement(D.Z,{variant:"delta",textColor:"primary600"},".",V)),t.createElement(o.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},t.createElement(Re,{background:b.background,borderColor:b.border,padding:2},t.createElement(D.Z,{fontWeight:"bold",textColor:b.text},d)),t.createElement(L.x,{paddingLeft:2,paddingRight:2},Ae()(x,F=>t.createElement(D.Z,{key:F,textColor:F.includes(":")?"neutral600":"neutral900"},"/",F)))))}se.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},se.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Oe=se,Ie=()=>{const{value:{selectedAction:l,routes:c}}=M(),{formatMessage:d}=(0,u.Z)(),R=l?.split(".")[0];return t.createElement(B.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},l?t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},c[R]?.map(E=>E.config.auth?.scope?.includes(l)||E.handler===l?t.createElement(Oe,{key:E.handler,route:E}):null)):t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(D.Z,{variant:"delta",as:"h3"},d({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),t.createElement(D.Z,{as:"p",textColor:"neutral600"},d({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var De=e(63122),xe=e(1744),Se=e(68889),ue=e(22546),ke=e(40989),Le=e(48403),Be=e.n(Le);const ge=(0,ee.iv)`
  background: ${l=>l.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Ue=(0,ee.ZP)(L.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${l=>l.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${l=>l.isActive&&ge}
  &:hover {
    ${ge}
  }
`,Ze=ee.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:l})=>l.colors.neutral150};
`,ae=({controllers:l,label:c,orderNumber:d,disabled:R,onExpanded:E,indexExpandendCollapsedContent:x})=>{const{value:{onChangeSelectAll:y,onChange:V,selectedActions:b,setSelectedAction:F,selectedAction:J}}=M(),[$,te]=(0,t.useState)(!1),{formatMessage:re}=(0,u.Z)(),w=()=>{te(S=>!S),E(d)};(0,t.useEffect)(()=>{x!==null&&x!==d&&$&&te(!1)},[x,d,$]);const Z=S=>S===J;return t.createElement(De.U,{expanded:$,onToggle:w,variant:d%2?"primary":"secondary"},t.createElement(xe.B,{title:Be()(c)}),t.createElement(Se.v,null,l?.map(S=>{const _=S.actions.every(N=>b.includes(N.actionId)),le=S.actions.some(N=>b.includes(N.actionId));return t.createElement(L.x,{key:`${c}.${S?.controller}`},t.createElement(o.k,{justifyContent:"space-between",alignItems:"center",padding:4},t.createElement(L.x,{paddingRight:4},t.createElement(D.Z,{variant:"sigma",textColor:"neutral600"},S?.controller)),t.createElement(Ze,null),t.createElement(L.x,{paddingLeft:4},t.createElement(ue.X,{value:_,indeterminate:!_&&le,onValueChange:()=>{y({target:{value:[...S.actions]}})},disabled:R},re({id:"app.utils.select-all",defaultMessage:"Select all"})))),t.createElement(K.r,{gap:4,padding:4},S?.actions&&S?.actions.map(N=>t.createElement(B.P,{col:6,key:N.actionId},t.createElement(Ue,{isActive:Z(N.actionId),padding:2,hasRadius:!0},t.createElement(ue.X,{value:b.includes(N.actionId),name:N.actionId,onValueChange:()=>{V({target:{value:N.actionId}})},disabled:R},N.action),t.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>F({target:{value:N.actionId}}),style:{display:"inline-flex",alignItems:"center"}},t.createElement(ke.Z,null)))))))})))};ae.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ae.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const Ne=ae,oe=({section:l,...c})=>{const[d,R]=(0,t.useState)(null),E=x=>R(x);return t.createElement(L.x,{padding:4,background:"neutral0"},l&&l.map((x,y)=>t.createElement(Ne,{key:x.apiId,label:x.label,controllers:x.controllers,orderNumber:y,indexExpandendCollapsedContent:d,onExpanded:E,name:x.apiId,...c})))};oe.defaultProps={section:null},oe.propTypes={section:n().arrayOf(n().object)};const We=oe,Ke=({...l})=>{const{value:{data:c}}=M(),{formatMessage:d}=(0,u.Z)();return t.createElement(K.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},t.createElement(B.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(D.Z,{variant:"delta",as:"h2"},d({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),t.createElement(D.Z,{as:"p",textColor:"neutral600"},d({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),c?.permissions&&t.createElement(We,{section:c?.permissions,...l})),t.createElement(Ie,null))},be=(0,t.memo)(Ke);var ie=e(51352);const Fe=(l,c=[])=>({...l,selectedAction:null,routes:[],selectedActions:[],data:(0,ie.mk)(c)});var $e=e(18172),He=e(97019),me=e.n(He);const Ve={data:{},selectedActions:[]},Ge=(l,c)=>(0,$e.ZP)(l,d=>{switch(c.type){case"ON_CHANGE":{d.selectedActions.includes(c.value)?me()(d.selectedActions,c.value):d.selectedActions.push(c.value);break}case"SELECT_ALL_IN_PERMISSION":{c.value.every(E=>d.selectedActions.includes(E.actionId))?c.value.forEach(E=>{me()(d.selectedActions,E.actionId)}):c.value.forEach(E=>{d.selectedActions.push(E.actionId)});break}case"SELECT_ALL_ACTIONS":{d.selectedActions=[...d.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const R=d.data.allActionsIds.filter(E=>E.includes("find")||E.includes("findOne"));d.selectedActions=[...R];break}case"UPDATE_PERMISSIONS_LAYOUT":{d.data=(0,ie.mk)(c.value);break}case"UPDATE_ROUTES":{d.routes={...c.value};break}case"UPDATE_PERMISSIONS":{d.selectedActions=[...c.value];break}case"SET_SELECTED_ACTION":{d.selectedAction=c.value;break}default:return d}}),ze="Name already taken",Xe=()=>{(0,s.useFocusWhenNavigate)();const{formatMessage:l}=(0,u.Z)(),{lockApp:c,unlockApp:d}=(0,s.useOverlayBlocker)(),R=(0,s.useNotification)(),E=(0,v.k6)(),x=(0,a.v9)(O._),[y,V]=(0,t.useState)(E.location.state?.apiToken.accessKey?{...E.location.state.apiToken}:null),{trackUsage:b}=(0,s.useTracking)(),F=(0,t.useRef)(b),{setCurrentStep:J}=(0,s.useGuidedTour)(),{allowedActions:{canCreate:$,canUpdate:te,canRegenerate:re}}=(0,s.useRBAC)(x.settings["api-tokens"]),[w,Z]=(0,t.useReducer)(Ge,Ve,m=>Fe(m,{})),{params:{id:S}}=(0,v.$B)("/settings/api-tokens/:id"),{get:_,post:le,put:N}=(0,s.useFetchClient)(),W=S==="create";(0,T.useQuery)("content-api-permissions",async()=>{const[m,j]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async q=>{const{data:U}=await _(q);return U.data}));Z({type:"UPDATE_PERMISSIONS_LAYOUT",value:m}),Z({type:"UPDATE_ROUTES",value:j}),y&&(y?.type==="read-only"&&Z({type:"ON_CHANGE_READ_ONLY"}),y?.type==="full-access"&&Z({type:"SELECT_ALL_ACTIONS"}),y?.type==="custom"&&Z({type:"UPDATE_PERMISSIONS",value:y?.permissions}))},{onError(){R({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,t.useEffect)(()=>{F.current(W?"didAddTokenFromList":"didEditTokenFromList",{tokenType:I.Z})},[W]);const{status:Ye}=(0,T.useQuery)(["api-token",S],async()=>{const{data:{data:m}}=await _(`/admin/api-tokens/${S}`);return V({...m}),m?.type==="read-only"&&Z({type:"ON_CHANGE_READ_ONLY"}),m?.type==="full-access"&&Z({type:"SELECT_ALL_ACTIONS"}),m?.type==="custom"&&Z({type:"UPDATE_PERMISSIONS",value:m?.permissions}),m},{enabled:!W&&!y,onError(){R({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),je=async(m,j)=>{F.current(W?"willCreateToken":"willEditToken",{tokenType:I.Z}),c();const q=m.lifespan&&parseInt(m.lifespan,10)&&m.lifespan!=="0"?parseInt(m.lifespan,10):null;try{const{data:{data:U}}=W?await le("/admin/api-tokens",{...m,lifespan:q,permissions:m.type==="custom"?w.selectedActions:null}):await N(`/admin/api-tokens/${S}`,{name:m.name,description:m.description,type:m.type,permissions:m.type==="custom"?w.selectedActions:null});W&&(E.replace(`/settings/api-tokens/${U.id}`,{apiToken:U}),J("apiTokens.success")),d(),V({...U}),R({type:"success",message:l(W?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),F.current(W?"didCreateToken":"didEditToken",{type:y.type,tokenType:I.Z})}catch(U){const pe=(0,h.Iz)(U.response.data);j.setErrors(pe),U?.response?.data?.error?.message===ze?R({type:"warning",message:U.response.data.message||"notification.error.tokennamenotunique"}):R({type:"warning",message:U?.response?.data?.message||"notification.error"}),d()}},[Qe,ce]=(0,t.useState)(!1),Je={...w,onChange:({target:{value:m}})=>{ce(!0),Z({type:"ON_CHANGE",value:m})},onChangeSelectAll:({target:{value:m}})=>{ce(!0),Z({type:"SELECT_ALL_IN_PERMISSION",value:m})},setSelectedAction:({target:{value:m}})=>{Z({type:"SET_SELECTED_ACTION",value:m})}},de=te&&!W||$&&W;return!W&&!y&&Ye!=="success"?t.createElement(he,{apiTokenName:y?.name}):t.createElement(P,{value:Je},t.createElement(p.o,null,t.createElement(s.SettingsPageTitle,{name:"API Tokens"}),t.createElement(i.J9,{validationSchema:ie.fK,validateOnChange:!1,initialValues:{name:y?.name||"",description:y?.description||"",type:y?.type,lifespan:y?.lifespan?y.lifespan.toString():y?.lifespan},enableReinitialize:!0,onSubmit:(m,j)=>je(m,j)},({errors:m,handleChange:j,isSubmitting:q,values:U,setFieldValue:pe})=>(Qe&&U?.type!=="custom"&&pe("type","custom"),t.createElement(s.Form,null,t.createElement(k.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:y,setToken:V,canEditInputs:de,canRegenerate:re,isSubmitting:q,regenerateUrl:"/admin/api-tokens/"}),t.createElement(r.D,null,t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(y?.name)&&t.createElement(X.Z,{token:y?.accessKey,tokenType:I.Z}),t.createElement(Ee,{errors:m,onChange:j,canEditInputs:de,isCreating:W,values:U,apiToken:y,onDispatch:Z,setHasChangedPermissions:ce}),t.createElement(be,{disabled:!de||U?.type==="read-only"||U?.type==="full-access"}))))))))}},51352:(f,g,e)=>{"use strict";e.d(g,{IX:()=>s,fK:()=>a,mk:()=>A});var t=e(66115),p=e(77349),r=e(51991);const s=(n,C,P="en")=>{if(C&&typeof C=="number"){const M=C/24/60/60/1e3;return(0,t.Z)((0,p.Z)(new Date(n),M),"PPP",{locale:r[P]})}return"Unlimited"};var i=e(32638),u=e(87561);const a=u.Ry().shape({name:u.Z_(i.translatedErrors.string).max(100).required(i.translatedErrors.required),type:u.Z_(i.translatedErrors.string).oneOf(["read-only","full-access","custom"]).required(i.translatedErrors.required),description:u.Z_().nullable(),lifespan:u.Rx().integer().min(0).nullable().defined(i.translatedErrors.required)}),A=n=>{const C={allActionsIds:[],permissions:[]};return C.permissions=Object.keys(n).map(P=>({apiId:P,label:P.split("::")[1],controllers:Object.keys(n[P].controllers).map(M=>({controller:M,actions:n[P].controllers[M].map(h=>{const O=`${P}.${M}.${h}`;return P.includes("api::")&&C.allActionsIds.push(O),{action:h,actionId:O}}).flat()})).flat()})),C}},41848:f=>{function g(e,t,p,r){for(var o=e.length,s=p+(r?1:-1);r?s--:++s<o;)if(t(e[s],s,e))return s;return-1}f.exports=g},42118:(f,g,e)=>{var t=e(41848),p=e(62722),r=e(42351);function o(s,i,u){return i===i?r(s,i,u):t(s,p,u)}f.exports=o},74221:f=>{function g(e,t,p,r){for(var o=p-1,s=e.length;++o<s;)if(r(e[o],t))return o;return-1}f.exports=g},62722:f=>{function g(e){return e!==e}f.exports=g},65464:(f,g,e)=>{var t=e(29932),p=e(42118),r=e(74221),o=e(7518),s=e(278),i=Array.prototype,u=i.splice;function T(a,v,A,n){var C=n?r:p,P=-1,M=v.length,h=a;for(a===v&&(v=s(v)),A&&(h=t(a,o(A)));++P<M;)for(var O=0,I=v[P],k=A?A(I):I;(O=C(h,k,O,n))>-1;)h!==a&&u.call(h,O,1),u.call(a,O,1);return a}f.exports=T},42351:f=>{function g(e,t,p){for(var r=p-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}f.exports=g},35161:(f,g,e)=>{var t=e(29932),p=e(67206),r=e(69199),o=e(1469);function s(i,u){var T=o(i)?t:r;return T(i,p(u,3))}f.exports=s},97019:(f,g,e)=>{var t=e(5976),p=e(45604),r=t(p);f.exports=r},45604:(f,g,e)=>{var t=e(65464);function p(r,o){return r&&r.length&&o&&o.length?t(r,o):r}f.exports=p},13217:(f,g,e)=>{var t=e(14259);function p(r){var o=r==null?0:r.length;return o?t(r,1,o):[]}f.exports=p}}]);
