"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[2812],{13882:(b,v,t)=>{t.d(v,{Z:()=>e});function e(n,p){if(p.length<n)throw new TypeError(n+" argument"+(n>1?"s":"")+" required, but only "+p.length+" present")}},83946:(b,v,t)=>{t.d(v,{Z:()=>e});function e(n){if(n===null||n===!0||n===!1)return NaN;var p=Number(n);return isNaN(p)?p:p<0?Math.ceil(p):Math.floor(p)}},12902:(b,v,t)=>{t.d(v,{Z:()=>oe});var e=7,n=365.2425,p=Math.pow(10,8)*24*60*60*1e3,y=6e4,h=36e5,I=1e3,f=-p,R=60,O=3,P=12,L=4,U=3600,S=60,N=U*24,A=N*7,x=N*n,G=x/12,ge=G*3,re=t(13882),ie=t(83946);function oe(s,a){var r;(0,re.Z)(1,arguments);var i=(0,ie.Z)((r=a?.additionalDigits)!==null&&r!==void 0?r:2);if(i!==2&&i!==1&&i!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof s=="string"||Object.prototype.toString.call(s)==="[object String]"))return new Date(NaN);var d=pe(s),M;if(d.date){var K=te(d.date,i);M=H(K.restDateString,K.year)}if(!M||isNaN(M.getTime()))return new Date(NaN);var B=M.getTime(),F=0,W;if(d.time&&(F=Q(d.time),isNaN(F)))return new Date(NaN);if(d.timezone){if(W=ue(d.timezone),isNaN(W))return new Date(NaN)}else{var Z=new Date(B+F),Y=new Date(0);return Y.setFullYear(Z.getUTCFullYear(),Z.getUTCMonth(),Z.getUTCDate()),Y.setHours(Z.getUTCHours(),Z.getUTCMinutes(),Z.getUTCSeconds(),Z.getUTCMilliseconds()),Y}return new Date(B+F+W)}var V={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},le=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,l=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,de=/^([+-])(\d{2})(?::?(\d{2}))?$/;function pe(s){var a={},r=s.split(V.dateTimeDelimiter),i;if(r.length>2)return a;if(/:/.test(r[0])?i=r[0]:(a.date=r[0],i=r[1],V.timeZoneDelimiter.test(a.date)&&(a.date=s.split(V.timeZoneDelimiter)[0],i=s.substr(a.date.length,s.length))),i){var d=V.timezone.exec(i);d?(a.time=i.replace(d[1],""),a.timezone=d[1]):a.time=i}return a}function te(s,a){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+a)+"})|(\\d{2}|[+-]\\d{"+(2+a)+"})$)"),i=s.match(r);if(!i)return{year:NaN,restDateString:""};var d=i[1]?parseInt(i[1]):null,M=i[2]?parseInt(i[2]):null;return{year:M===null?d:M*100,restDateString:s.slice((i[1]||i[2]).length)}}function H(s,a){if(a===null)return new Date(NaN);var r=s.match(le);if(!r)return new Date(NaN);var i=!!r[4],d=j(r[1]),M=j(r[2])-1,K=j(r[3]),B=j(r[4]),F=j(r[5])-1;if(i)return me(a,B,F)?ae(a,B,F):new Date(NaN);var W=new Date(0);return!w(a,M,K)||!ee(a,d)?new Date(NaN):(W.setUTCFullYear(a,M,Math.max(d,K)),W)}function j(s){return s?parseInt(s):1}function Q(s){var a=s.match(l);if(!a)return NaN;var r=k(a[1]),i=k(a[2]),d=k(a[3]);return ne(r,i,d)?r*h+i*y+d*1e3:NaN}function k(s){return s&&parseFloat(s.replace(",","."))||0}function ue(s){if(s==="Z")return 0;var a=s.match(de);if(!a)return 0;var r=a[1]==="+"?-1:1,i=parseInt(a[2]),d=a[3]&&parseInt(a[3])||0;return ce(i,d)?r*(i*h+d*y):NaN}function ae(s,a,r){var i=new Date(0);i.setUTCFullYear(s,0,4);var d=i.getUTCDay()||7,M=(a-1)*7+r+1-d;return i.setUTCDate(i.getUTCDate()+M),i}var q=[31,null,31,30,31,30,31,31,30,31,30,31];function _(s){return s%400===0||s%4===0&&s%100!==0}function w(s,a,r){return a>=0&&a<=11&&r>=1&&r<=(q[a]||(_(s)?29:28))}function ee(s,a){return a>=1&&a<=(_(s)?366:365)}function me(s,a,r){return a>=1&&a<=53&&r>=0&&r<=6}function ne(s,a,r){return s===24?a===0&&r===0:r>=0&&r<60&&a>=0&&a<60&&s>=0&&s<25}function ce(s,a){return a>=0&&a<=59}},50935:(b,v,t)=>{t.d(v,{R:()=>y});var e=t(56127),n=t(36232),p=t(88767);function y(h={},I={}){const{id:f="",...R}=h,O=(0,n.stringify)(R,{encode:!1}),{get:P}=(0,e.kY)(),{data:L,isError:U,isLoading:S,refetch:N}=(0,p.useQuery)(["users",f,R],async()=>{const{data:{data:x}}=await P(`/admin/users/${f}${O?`?${O}`:""}`);return x},I);let A=[];return f&&L?A=[L]:Array.isArray(L?.results)&&(A=L.results),{users:A,pagination:L?.pagination??null,isLoading:S,isError:U,refetch:N}}},94699:(b,v,t)=>{t.d(v,{Z:()=>P});var e=t(53547),n=t(50781),p=t(19442),y=t(56127),h=t(36002),I=t(45697),f=t.n(I),R=t(86896);const O=({displayedFilters:L})=>{const[U,S]=(0,e.useState)(!1),{formatMessage:N}=(0,R.Z)(),A=(0,e.useRef)(),x=()=>{S(G=>!G)};return e.createElement(e.Fragment,null,e.createElement(n.x,{paddingTop:1,paddingBottom:1},e.createElement(p.z,{variant:"tertiary",ref:A,startIcon:e.createElement(h.Z,null),onClick:x,size:"S"},N({id:"app.utils.filters",defaultMessage:"Filters"})),U&&e.createElement(y.J5,{displayedFilters:L,isVisible:U,onToggle:x,source:A})),e.createElement(y.W$,{filtersSchema:L}))};O.propTypes={displayedFilters:f().arrayOf(f().shape({name:f().string.isRequired,metadatas:f().shape({label:f().string}),fieldSchema:f().shape({type:f().string})})).isRequired};const P=O},35915:(b,v,t)=>{t.r(v),t.d(v,{default:()=>De});var e=t(53547),n=t(56127),p=t(86706),y=t(99369),h=t(45349),I=t(26789),f=t(50781),R=t(57713),O=t(79371),P=t(15483),L=t(86896),U=t(94699),S=t(88767),N=t(55168),A=t(50935);const G=({canReadAuditLogs:o,canReadUsers:E})=>{const{get:T}=(0,n.kY)(),{search:m}=(0,N.TH)(),D=(0,n.lm)(),c={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:X=>D({type:"warning",message:X.message})},{users:u,isError:g,isLoading:C}=(0,A.R)({},{...c,enabled:E,staleTime:2*(1e3*60)}),{data:$,isLoading:J,isError:se}=(0,S.useQuery)(["auditLogs",m],async({queryKey:X})=>{const z=X[1],{data:Le}=await T(`/admin/audit-logs${z}`);return Le},{...c,enabled:o});return{auditLogs:$,users:u,isLoading:C||J,hasError:se||g}};var ge=t(60881),re=t(18189),ie=t(48683),oe=t(63321),V=t(36773),le=t(45697),l=t.n(le),de=t(12902);const te=()=>{const{formatDate:o}=(0,L.Z)();return T=>{const m=(0,de.Z)(T),D=o(m,{dateStyle:"long"}),c=o(m,{timeStyle:"medium",hourCycle:"h24"});return`${D}, ${c}`}};var H=t(75878),j=t(28809),Q=t(78549),k=t(9370),ue=t(91132);const ae={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},q=o=>ae[o]||o,_=({actionLabel:o,actionName:E})=>e.createElement(H.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(Q.Z,{textColor:"neutral600",variant:"sigma"},o),e.createElement(Q.Z,{textColor:"neutral600"},E));_.propTypes={actionLabel:l().string.isRequired,actionName:l().string.isRequired};const w=_,ee=({status:o,data:E,formattedDate:T})=>{const{formatMessage:m}=(0,L.Z)();if(o==="loading")return e.createElement(H.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(j.a,null,"Loading content..."));const{action:D,user:c,payload:u}=E;return e.createElement(e.Fragment,null,e.createElement(f.x,{marginBottom:3},e.createElement(Q.Z,{variant:"delta",id:"title"},m({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(k.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(w,{actionLabel:m({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:m({id:`Settings.permissions.auditLogs.${D}`,defaultMessage:q(D)},{model:u?.model})}),e.createElement(w,{actionLabel:m({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:T}),e.createElement(w,{actionLabel:m({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:c?.displayName||"-"}),e.createElement(w,{actionLabel:m({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:c?.id.toString()||"-"})),e.createElement(ue.V,{value:JSON.stringify(u,null,2),disabled:!0,label:m({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};ee.defaultProps={data:{}},ee.propTypes={status:l().oneOf(["idle","loading","error","success"]).isRequired,data:l().shape({action:l().string,date:l().string,payload:l().object,user:l().object}),formattedDate:l().string.isRequired};const me=ee,ne=({handleClose:o,logId:E})=>{const{get:T}=(0,n.kY)(),m=(0,n.lm)(),D=async $=>{const{data:J}=await T(`/admin/audit-logs/${$}`);if(!J)throw new Error("Audit log not found");return J},{data:c,status:u}=(0,S.useQuery)(["audit-log",E],()=>D(E),{onError(){m({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),o()}}),g=te(),C=c?g(c.date):"";return e.createElement(ge.P,{onClose:o,labelledBy:"title"},e.createElement(re.x,null,e.createElement(oe.O,{label:C,id:"title"},e.createElement(V.$,{isCurrent:!0},C))),e.createElement(ie.f,null,e.createElement(me,{status:u,data:c,formattedDate:C})))};ne.propTypes={handleClose:l().func.isRequired,logId:l().string.isRequired};const ce=ne,s=({pagination:o})=>e.createElement(f.x,{paddingTop:4},e.createElement(H.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(n.v4,null),e.createElement(n.tU,{pagination:o})));s.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},s.propTypes={pagination:l().shape({page:l().number,pageCount:l().number,pageSize:l().number,total:l().number})};const a=s;var r=t(94487),i=t(6090),d=t(62351),M=t(37527),K=t(2953);const B=({headers:o,rows:E,onOpenModal:T})=>{const{formatMessage:m}=(0,L.Z)(),D=te(),c=({type:u,value:g,model:C})=>u==="date"?D(g):u==="action"?m({id:`Settings.permissions.auditLogs.${g}`,defaultMessage:q(g)},{model:C}):g||"-";return e.createElement(r.p,null,E.map(u=>e.createElement(i.Tr,{key:u.id,...(0,n.X7)({fn:()=>T(u.id)})},o.map(({key:g,name:C,cellFormatter:$})=>e.createElement(d.Td,{key:g},e.createElement(Q.Z,{textColor:"neutral800"},c({type:g,value:$?$(u[C]):u[C],model:u.payload?.model})))),e.createElement(d.Td,{...n.UW},e.createElement(H.k,{justifyContent:"end"},e.createElement(M.h,{onClick:()=>T(u.id),"aria-label":m({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${u.action} action`}),noBorder:!0,icon:e.createElement(K.Z,null)}))))))};B.defaultProps={rows:[]},B.propTypes={headers:l().array.isRequired,rows:l().array,onOpenModal:l().func.isRequired};const F=B;var W=t(63122),Z=t(85612);const Y=({value:o,options:E,onChange:T})=>{const{formatMessage:m}=(0,L.Z)(),D=m({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(W.hQ,{"aria-label":D,value:o,onChange:T},E.map(({label:c,customValue:u})=>e.createElement(Z.O,{key:u,value:u},c)))};Y.defaultProps={value:null},Y.propTypes={value:l().string,options:l().arrayOf(l().shape({label:l().string.isRequired,customValue:l().string.isRequired}).isRequired).isRequired,onChange:l().func.isRequired};const fe=Y,ve=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],Ee=({formatMessage:o,users:E,canReadUsers:T})=>{const m=Object.keys(ae).map(c=>({label:o({id:`Settings.permissions.auditLogs.${c}`,defaultMessage:q(c)},{model:void 0}),customValue:c})),D=[{name:"action",metadatas:{customOperators:ve,label:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:m,customInput:fe},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(T&&E){const c=g=>g.username?g.username:g.firstname&&g.lastname?o({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:g.firstname,lastname:g.lastname}):g.email,u=E.map(g=>({label:c(g),customValue:g.id.toString()}));return[...D,{name:"user",metadatas:{customOperators:ve,label:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:u,customInput:fe},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return D},ye=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:o=>o?o.displayName:""}],he=()=>{const{formatMessage:o}=(0,L.Z)(),E=(0,p.v9)(y._),{allowedActions:{canRead:T,canReadUsers:m}}=(0,n.ss)({...E.settings.auditLogs,readUsers:E.settings.users.read}),[{query:D},c]=(0,n.Kx)(),{auditLogs:u,users:g,isLoading:C,hasError:$}=G({canReadAuditLogs:T,canReadUsers:m});(0,n.go)();const J=Ee({formatMessage:o,users:g,canReadUsers:m}),se=o({id:"global.auditLogs",defaultMessage:"Audit Logs"}),X=ye.map(z=>({...z,metadatas:{...z.metadatas,label:o(z.metadatas.label)}}));return $?e.createElement(h.A,null,e.createElement(I.D,null,e.createElement(f.x,{paddingTop:8},e.createElement(n.Hn,null)))):e.createElement(R.o,{"aria-busy":C},e.createElement(n.SL,{name:se}),e.createElement(O.T,{title:se,subtitle:o({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(P.Z,{startActions:e.createElement(U.Z,{displayedFilters:J})}),e.createElement(I.D,{canRead:T},e.createElement(n.tM,{contentType:"Audit logs",headers:X,rows:u?.results||[],withBulkActions:!0,isLoading:C},e.createElement(F,{headers:X,rows:u?.results||[],onOpenModal:z=>c({id:z})})),e.createElement(a,{pagination:u?.pagination})),D?.id&&e.createElement(ce,{handleClose:()=>c({id:null},"remove"),logId:D.id}))},De=()=>{const o=(0,p.v9)(y._);return e.createElement(n.O4,{permissions:o.settings.auditLogs.main},e.createElement(he,null))}},85612:(b,v,t)=>{t.d(v,{O:()=>n});var e=t(63122);const n=e.Wx},15483:(b,v,t)=>{t.d(v,{Z:()=>p});var e=t(2790),n=t(75878);const p=({startActions:y,endActions:h})=>!y&&!h?null:(0,e.jsxs)(n.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(n.k,{gap:2,wrap:"wrap",children:y}),(0,e.jsx)(n.k,{gap:2,shrink:0,wrap:"wrap",children:h})]})},63321:(b,v,t)=>{t.d(v,{O:()=>O});var e=t(53547),n=t(45697),p=t(88972),y=t(41580),h=t(75515);const I=()=>e.createElement(y.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1},e.createElement(h.Z,{variant:"pi",textColor:"neutral500"},"/"));I.displayName="Divider";var f=t(11047);const R=(0,p.ZP)(f.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:P})=>`calc(-1*${P.spaces[2]})`};
  }
`,O=({label:P,children:L,...U})=>{const S=e.Children.toArray(L);return e.createElement(y.x,{"aria-label":P,...U},e.createElement(R,{as:"ol",horizontal:!0},e.Children.map(S,(N,A)=>{const x=S.length>1&&A+1<S.length;return e.createElement(f.k,{inline:!0,as:"li"},N,x&&e.createElement(I,null))})))};O.displayName="Breadcrumbs",O.propTypes={children:n.oneOfType([n.arrayOf(n.node),n.node]).isRequired,label:n.string.isRequired}},36773:(b,v,t)=>{t.d(v,{$:()=>h});var e=t(53547),n=t(45697),p=t(41580),y=t(75515);const h=({children:I,isCurrent:f,...R})=>e.createElement(p.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},e.createElement(y.Z,{variant:"pi",textColor:"neutral800",fontWeight:f?"bold":"normal","aria-current":f,...R},I));h.displayName="Crumb",h.defaultProps={isCurrent:!1},h.propTypes={children:n.node.isRequired,isCurrent:n.bool}}}]);
