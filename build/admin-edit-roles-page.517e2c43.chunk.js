(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[2544],{98374:(U,V,i)=>{"use strict";i.d(V,{F:()=>k});var e=i(67294),b=i(32638),D=i(86896),E=i(88767);const k=($={},P={})=>{const{id:L="",...I}=$,{get:w}=(0,b.useFetchClient)(),{locale:r}=(0,D.Z)(),Z=(0,b.useCollator)(r,{sensitivity:"base"}),{data:y,error:ae,isError:he,isLoading:h,refetch:S}=(0,E.useQuery)(["roles",L,I],async()=>{const{data:ee}=await w(`/admin/roles/${L??""}`,{params:I});return ee},P);return{roles:e.useMemo(()=>{let ee=[];return y&&(Array.isArray(y.data)?ee=y.data:ee=[y.data]),[...ee].sort((Ee,le)=>Z.compare(Ee.name,le.name))},[y,Z]),error:ae,isError:he,isLoading:h,refetch:S}}},24233:(U,V,i)=>{"use strict";i.d(V,{V:()=>D});var e=i(32638),b=i(88767);const D=(E={id:null},k={})=>{const{id:$,...P}=E,{get:L}=(0,e.useFetchClient)(),{data:I,error:w,isError:r,isLoading:Z,refetch:y}=(0,b.useQuery)(["roles",$,"permissions",P],async()=>{const{data:{data:ae}}=await L(`/admin/roles/${$}/permissions`,{params:P});return ae},k);return{permissions:I,error:w,isError:r,isLoading:Z,refetch:y}}},25545:(U,V,i)=>{"use strict";i.r(V),i.d(V,{CreatePage:()=>fe,default:()=>je});var e=i(67294),b=i(40720),D=i(90731),E=i(96987),k=i(12473),$=i(34726),P=i(16607),L=i(71068),I=i(31988),w=i(6498),r=i(38670),Z=i(457),y=i(32638),ae=i(97695),he=i(66115),h=i(41054),S=i(41609),Q=i.n(S),ee=i(86896),Ee=i(86706),le=i(16550),A=i(71997),De=i(36364),Se=i(30909),ne=i(90065),te=i(24233),ce=i(87561);const Ge=ce.Ry().shape({name:ce.Z_().required(y.translatedErrors.required),description:ce.Z_().required(y.translatedErrors.required)}),be=A.ZP.div`
  border: 1px solid ${({theme:H})=>H.colors.primary200};
  background: ${({theme:H})=>H.colors.primary100};
  padding: ${({theme:H})=>`${H.spaces[2]} ${H.spaces[4]}`};
  color: ${({theme:H})=>H.colors.primary600};
  border-radius: ${({theme:H})=>H.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,fe=()=>{const H=(0,le.$B)("/settings/roles/duplicate/:id"),Oe=(0,y.useNotification)(),{lockApp:j,unlockApp:K}=(0,y.useOverlayBlocker)(),{formatMessage:M}=(0,ee.Z)(),[J,se]=(0,e.useState)(!1),{replace:de}=(0,le.k6)(),W=(0,e.useRef)(),{trackUsage:ye}=(0,y.useTracking)(),{post:ue,put:Fe}=(0,y.useFetchClient)(),{params:me}=H??{},{isLoading:Ie,data:Ze}=(0,ne.d)(me?.id,{cacheTime:0}),{permissions:oe,isLoading:ve}=(0,te.V)({id:me?.id},{cacheTime:0,enabled:!!me?.id}),Be=Re=>{j(),se(!0),me?.id?ye("willDuplicateRole"):ye("willCreateNewRole"),Promise.resolve(ue("/admin/roles",Re)).then(async({data:q})=>{const{permissionsToSend:_}=W.current.getPermissions();return me?.id?ye("didDuplicateRole"):ye("didCreateNewRole"),q.data.id&&!Q()(_)&&await Fe(`/admin/roles/${q.data.id}/permissions`,{permissions:_}),q}).then(q=>{se(!1),Oe({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),de(`/settings/roles/${q.data.id}`)}).catch(q=>{console.error(q),se(!1),Oe({type:"warning",message:{id:"notification.error"}})}).finally(()=>{K()})},Ne=`${M({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,he.Z)(new Date,"PPP")}`;return e.createElement(b.o,null,e.createElement(y.SettingsPageTitle,{name:"Roles"}),e.createElement(h.J9,{initialValues:{name:"",description:Ne},onSubmit:Be,validationSchema:Ge,validateOnChange:!1},({handleSubmit:Re,values:q,errors:_,handleReset:pe,handleChange:z})=>e.createElement(y.Form,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement(D.T,{primaryAction:e.createElement(E.k,{gap:2},e.createElement(k.z,{variant:"secondary",onClick:()=>{pe(),W.current.resetForm()},size:"L"},M({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(k.z,{onClick:Re,loading:J,size:"L"},M({id:"global.save",defaultMessage:"Save"}))),title:M({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:M({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(y.Link,{startIcon:e.createElement(ae.Z,null),to:"/settings/roles"},M({id:"global.back",defaultMessage:"Back"}))}),e.createElement($.D,null,e.createElement(E.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(P.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(E.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(E.k,{justifyContent:"space-between"},e.createElement(P.x,null,e.createElement(P.x,null,e.createElement(L.Z,{fontWeight:"bold"},M({id:"global.details",defaultMessage:"Details"}))),e.createElement(P.x,null,e.createElement(L.Z,{variant:"pi",textColor:"neutral600"},M({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(be,null,M({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(I.r,{gap:4},e.createElement(w.P,{col:6},e.createElement(r.o,{name:"name",error:_.name&&M({id:_.name}),label:M({id:"global.name",defaultMessage:"Name"}),onChange:z,required:!0,value:q.name})),e.createElement(w.P,{col:6},e.createElement(Z.g,{label:M({id:"global.description",defaultMessage:"Description"}),id:"description",error:_.description&&M({id:_.description}),onChange:z},q.description))))),!Ie&&!ve?e.createElement(P.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(Se.Z,{isFormDisabled:!1,ref:W,permissions:oe,layout:Ze})):e.createElement(P.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(y.LoadingIndicatorPage,null))))))))};function je(){const H=(0,Ee.v9)(De._);return e.createElement(y.CheckPagePermissions,{permissions:H.settings.roles.create},e.createElement(fe,null))}},30909:(U,V,i)=>{"use strict";i.d(V,{Z:()=>ts});var e=i(67294),b=i(98948),D=i(91788),E=i(94955),k=i(32638),$=i(18721),P=i.n($),L=i(41609),I=i.n(L),w=i(45697),r=i.n(w),Z=i(86896),y=i(16607),ae=i(89734),he=i.n(ae),h=i(71997),S=i(96987),Q=i(12803),ee=i(73924),Ee=i(14981),le=i(27361),A=i.n(le),De=i(57557),Se=i.n(De);const ne=e.createContext(null),te=()=>e.useContext(ne);var ce=i(12473),ke=i(40989);const Ge=h.ZP.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,be=({onClick:t,className:n,hasConditions:o,variant:s})=>{const{formatMessage:a}=(0,Z.Z)();return e.createElement(Ge,{hasConditions:o,className:n},e.createElement(ce.z,{variant:s,startIcon:e.createElement(ke.Z,null),onClick:t},a({id:"global.settings",defaultMessage:"Settings"})))};be.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},be.propTypes={onClick:r().func.isRequired,className:r().string,hasConditions:r().bool,variant:r().string};const fe=(0,h.ZP)(be)``;var je=i(74622),H=i(36854),Oe=i(71543),j=i(71068),K=i(37022),M=i(82392),J=i(75071),se=i(18172),de=i(7739),W=i.n(de),ye=i(11700),ue=i.n(ye),Fe=i(13814);const me=t=>Object.values(t).map(n=>Object.entries(n).filter(([,o])=>o).map(([o])=>o)).flat(),Ie=t=>t.reduce((n,[o,s])=>(n.push({label:ue()(o),children:s.map(a=>({label:a.displayName,value:a.id}))}),n),[]),Ze=(t,n)=>t.map(([,o])=>o).flat().reduce((o,s)=>({[s.id]:n.includes(s.id),...o}),{}),oe=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:o,label:s,name:a,onChange:l,value:c})=>{const{formatMessage:d}=(0,Z.Z)(),m=u=>{l(a,Ze(t,u))};return e.createElement(S.k,{as:"li",background:o?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(S.k,{paddingLeft:6,style:{width:180}},e.createElement(j.Z,{variant:"sigma",textColor:"neutral600"},d({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(j.Z,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},d({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(j.Z,{variant:"sigma",textColor:"neutral600"},"\xA0",d({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(y.x,{style:{maxWidth:430,width:"100%"}},e.createElement(Fe.Q,{id:a,customizeContent:u=>`${u.length} currently selected`,onChange:m,value:me(c),options:Ie(t),disabled:n})))};oe.propTypes={arrayOfOptionsGroupedByCategory:r().array.isRequired,isFormDisabled:r().bool.isRequired,isGrey:r().bool.isRequired,label:r().string.isRequired,name:r().string.isRequired,value:r().object.isRequired,onChange:r().func.isRequired};const ve=oe,Be=(t,n)=>t.reduce((o,s)=>(o[s.id]=A()(n,s.id,!1),o),{}),Ne=(t,n)=>t.reduce((o,s)=>{const[a,l]=s,c=Be(l,n);return o[a]=c,o},{}),q=(t,n,o)=>t.reduce((s,a)=>{const l=A()(n,[...a.pathToConditionsObject,"conditions"],{}),c=Ne(o,l);return s[a.pathToConditionsObject.join("..")]=c,s},{}),_=({actions:t,headerBreadCrumbs:n,isFormDisabled:o,onClosed:s,onToggle:a})=>{const{formatMessage:l}=(0,Z.Z)(),{availableConditions:c,modifiedData:d,onChangeConditions:m}=te(),u=(0,e.useMemo)(()=>Object.entries(W()(c,"category")),[c]),p=t.filter(({isDisplayed:g,hasSomeActionsSelected:T,hasAllActionsSelected:R})=>g&&(T||R)),f=(0,e.useMemo)(()=>q(p,d,u),[p,d,u]),[v,F]=(0,e.useState)(f),x=(g,T)=>{F((0,se.ZP)(R=>{R[g]||(R[g]={}),R[g].default||(R[g].default={}),R[g].default=T}))},C=()=>{const g=Object.entries(v).reduce((T,R)=>{const[O,X]=R,N=Object.values(X).reduce((G,B)=>({...G,...B}),{});return T[O]=N,T},{});m(g),a()};return e.createElement(je.P,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(H.x,null,e.createElement(M.O,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map((g,T,R)=>e.createElement(J.$,{isCurrent:T===R.length-1,key:g},ue()(l({id:g,defaultMessage:g})))))),e.createElement(Oe.f,null,p.length===0&&e.createElement(j.Z,null,l({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,p.map(({actionId:g,label:T,pathToConditionsObject:R},O)=>{const X=R.join("..");return e.createElement(ve,{key:g,arrayOfOptionsGroupedByCategory:u,label:T,isFormDisabled:o,isGrey:O%2===0,name:X,onChange:x,value:A()(v,X,{})})}))),e.createElement(K.m,{startActions:e.createElement(ce.z,{variant:"tertiary",onClick:a},l({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(ce.z,{onClick:C},l({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};_.propTypes={actions:r().arrayOf(r().shape({actionId:r().string.isRequired,checkboxName:r().string,hasSomeActionsSelected:r().bool.isRequired,hasAllActionsSelected:r().bool,isDisplayed:r().bool.isRequired,label:r().string})).isRequired,headerBreadCrumbs:r().arrayOf(r().string).isRequired,isFormDisabled:r().bool.isRequired,onClosed:r().func.isRequired,onToggle:r().func.isRequired};const pe=_,z=`${120/16}rem`,Pe=`${200/16}rem`,Me=`${53/16}rem`,Ue=h.ZP.div`
  width: ${z};
`,it=(0,h.ZP)(S.k)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`,ze=({children:t,isCollapsable:n,isActive:o,isFormDisabled:s,label:a,onChange:l,onClick:c,checkboxName:d,someChecked:m,value:u})=>{const{formatMessage:p}=(0,Z.Z)();return e.createElement(S.k,{alignItems:"center",paddingLeft:6,style:{width:Pe,flexShrink:0}},e.createElement(y.x,{paddingRight:2},e.createElement(Q.C,{name:d,"aria-label":p({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:a}),disabled:s,onValueChange:f=>l({target:{name:d,value:f}}),indeterminate:m,value:u})),e.createElement(it,{title:a,alignItems:"center",isCollapsable:n,...n&&{onClick:c,"aria-expanded":o,onKeyDown:({key:f})=>(f==="Enter"||f===" ")&&c(),tabIndex:0,role:"button"}},e.createElement(j.Z,{fontWeight:o?"bold":"",textColor:o?"primary600":"neutral800",ellipsis:!0},ue()(a)),t))};ze.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},ze.propTypes={checkboxName:r().string,children:r().node,label:r().string.isRequired,isCollapsable:r().bool,isFormDisabled:r().bool.isRequired,onChange:r().func,onClick:r().func.isRequired,someChecked:r().bool,value:r().bool,isActive:r().bool.isRequired};const at=(0,e.memo)(ze);var Vt=i(42348),Wt=i.n(Vt),Ht=i(13218),Ce=i.n(Ht);const lt=t=>Ce()(t)?Wt()(Object.values(t).map(n=>Ce()(n)?lt(n):n)):[],$e=lt,Xe=t=>t?Object.keys(t).reduce((n,o)=>(o!=="conditions"&&(n[o]=t[o]),n),{}):null,Ae=t=>{const n=Xe(t),o=$e(n);if(!o.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=o.every(l=>l),a=o.some(l=>l)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:a}};var Gt=i(58471);const Ve=(0,h.ZP)(Gt.Z)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,We=t=>`
  ${j.Z} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${Ve} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`,Kt=(t,n,o)=>t.map(({actionId:s,isDisplayed:a,applyToProperties:l,label:c})=>{if(!a)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:a};const d=[...o.split(".."),s],m=I()(l)?[...d,"properties","enabled"]:d,u=m.join(".."),p=A()(n,[...d,"conditions"],null),f=$e(p).some(C=>C);if(I()(l)){const C=A()(n,m,!1);return{actionId:s,checkboxName:u,hasAllActionsSelected:C,hasConditions:f,hasSomeActionsSelected:C,isDisplayed:a,isParentCheckbox:!1,label:c,pathToConditionsObject:d}}const v=A()(n,m,null),{hasAllActionsSelected:F,hasSomeActionsSelected:x}=Ae(v);return{actionId:s,checkboxName:u,hasAllActionsSelected:F,hasConditions:f,hasSomeActionsSelected:x,isDisplayed:a,isParentCheckbox:!0,label:c,pathToConditionsObject:d}}),we=(t,n)=>`
  ${ct} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${ut} {
    display: flex;
  }
  ${fe} {
    display: block;
  }
  &:hover {
   ${We(t)}
  }

  &:focus-within {
    ${({theme:o,isActive:s})=>we(o,s)}
  }
  
`,ct=h.ZP.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${Me};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,Ut=h.ZP.div`
  display: inline-flex;
  min-width: 100%;

  ${fe} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&we(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>we(t,n)}
  }
`,dt=(0,h.ZP)(S.k)`
  width: ${z};
  position: relative;
`,ut=(0,h.ZP)(y.x)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,mt=h.ZP.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,zt=(0,h.ZP)(y.x)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,pt=({availableActions:t,isActive:n,isGrey:o,isFormDisabled:s,label:a,onClickToggle:l,pathToData:c})=>{const[d,m]=(0,e.useState)(!1),{formatMessage:u}=(0,Z.Z)(),{modifiedData:p,onChangeParentCheckbox:f,onChangeSimpleCheckbox:v}=te(),F=()=>{m(N=>!N)},x=()=>{m(!1)},C=A()(p,c.split(".."),{}),g=(0,e.useMemo)(()=>Object.keys(C).reduce((N,G)=>(N[G]=Se()(C[G],"conditions"),N),{}),[C]),{hasAllActionsSelected:T,hasSomeActionsSelected:R}=Ae(g),O=(0,e.useMemo)(()=>Kt(t,p,c),[t,p,c]),X=O.some(({hasConditions:N})=>N);return e.createElement(Ut,{isActive:n},e.createElement(ct,{isGrey:o},e.createElement(at,{isCollapsable:!0,isFormDisabled:s,label:a,checkboxName:c,onChange:f,onClick:l,someChecked:R,value:T,isActive:n},e.createElement(ut,{paddingLeft:2},n?e.createElement(ee.Z,null):e.createElement(Ee.Z,null))),e.createElement(S.k,{style:{flex:1}},O.map(({actionId:N,hasConditions:G,hasAllActionsSelected:B,hasSomeActionsSelected:ie,isDisplayed:Le,isParentCheckbox:Y,checkboxName:ge,label:He})=>Le?Y?e.createElement(dt,{key:N,justifyContent:"center",alignItems:"center"},G&&e.createElement(mt,null),e.createElement(Q.C,{disabled:s,name:ge,"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${He} ${a}`}),onValueChange:xe=>{f({target:{name:ge,value:xe}})},indeterminate:ie,value:B})):e.createElement(dt,{key:N,justifyContent:"center",alignItems:"center"},G&&e.createElement(mt,null),e.createElement(Q.C,{disabled:s,indeterminate:G,name:ge,onValueChange:xe=>{v({target:{name:ge,value:xe}})},value:B})):e.createElement(Ue,{key:N}))),d&&e.createElement(pe,{headerBreadCrumbs:[a,"Settings.permissions.conditions.conditions"],actions:O,isFormDisabled:s,onClosed:x,onToggle:F})),e.createElement(zt,null,e.createElement(fe,{onClick:F,hasConditions:X})))};pt.propTypes={availableActions:r().array.isRequired,isActive:r().bool.isRequired,isGrey:r().bool.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,onClickToggle:r().func.isRequired,pathToData:r().string.isRequired};const Xt=pt,wt=h.ZP.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`,gt=()=>e.createElement(wt,null,"*"),qt=(t,n)=>t.map(o=>{const s=Array.isArray(o.subjects)&&o.subjects.indexOf(n)!==-1;return{...o,isDisplayed:s}}),Yt=(0,h.ZP)(y.x)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,Qt=h.ZP.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,qe=t=>e.createElement(Yt,null,e.createElement(Qt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));qe.defaultProps={fill:"primary200"},qe.propTypes={fill:r().string};const Jt=(0,e.memo)(qe),ft=(0,h.ZP)(S.k)`
  width: ${z};
  position: relative;
`,_t=(0,h.ZP)(S.k)`
  height: ${Me};
`,en=(0,h.ZP)(y.x)`
  padding-left: ${31/16}rem;
`,tn=(0,h.ZP)(y.x)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,nn=(0,h.ZP)(S.k)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Ve} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${We(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&We(n)};
`,sn=h.ZP.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,Ye=({childrenForm:t,isFormDisabled:n,recursiveLevel:o,pathToDataFromActionRow:s,propertyActions:a,parentName:l,propertyName:c})=>{const{formatMessage:d}=(0,Z.Z)(),{modifiedData:m,onChangeParentCheckbox:u,onChangeSimpleCheckbox:p}=te(),[f,v]=(0,e.useState)(null),F=C=>{v(g=>g===C?null:C)},x=(0,e.useMemo)(()=>f?t.find(({value:C})=>C===f):null,[f,t]);return e.createElement(en,null,e.createElement(sn,null),t.map(({label:C,value:g,required:T,children:R},O)=>{const X=O+1<t.length,N=Array.isArray(R),G=f===g;return e.createElement(tn,{key:g,isVisible:X},e.createElement(_t,null,e.createElement(Jt,{color:"primary200"}),e.createElement(S.k,{style:{flex:1}},e.createElement(nn,{level:o,isActive:G,isCollapsable:N},e.createElement(it,{alignItems:"center",isCollapsable:N,...N&&{onClick:()=>F(g),"aria-expanded":G,onKeyDown:({key:B})=>(B==="Enter"||B===" ")&&F(g),tabIndex:0,role:"button"},title:C},e.createElement(j.Z,{ellipsis:!0},ue()(C)),T&&e.createElement(gt,null),e.createElement(Ve,{$isActive:G}))),e.createElement(S.k,{style:{flex:1}},a.map(({actionId:B,label:ie,isActionRelatedToCurrentProperty:Le})=>{if(!Le)return e.createElement(Ue,{key:B});const Y=[...s.split(".."),B,"properties",c,...l.split(".."),g],ge=A()(m,Y,!1);if(!R)return e.createElement(ft,{key:ie,justifyContent:"center",alignItems:"center"},e.createElement(Q.C,{disabled:n,name:Y.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${C} ${ie}`}),onValueChange:Te=>{p({target:{name:Y.join(".."),value:Te}})},value:ge}));const{hasAllActionsSelected:He,hasSomeActionsSelected:xe}=Ae(ge);return e.createElement(ft,{key:ie,justifyContent:"center",alignItems:"center"},e.createElement(Q.C,{key:ie,disabled:n,name:Y.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${C} ${ie}`}),onValueChange:Te=>{u({target:{name:Y.join(".."),value:Te}})},value:He,indeterminate:xe}))})))),x&&G&&e.createElement(y.x,{paddingBottom:2},e.createElement(Ye,{isFormDisabled:n,parentName:`${l}..${g}`,pathToDataFromActionRow:s,propertyActions:a,propertyName:c,recursiveLevel:o+1,childrenForm:x.children})))}))};Ye.propTypes={childrenForm:r().array.isRequired,isFormDisabled:r().bool.isRequired,parentName:r().string.isRequired,pathToDataFromActionRow:r().string.isRequired,propertyActions:r().array.isRequired,propertyName:r().string.isRequired,recursiveLevel:r().number.isRequired};const on=(0,e.memo)(Ye),rn=t=>t.reduce((o,s)=>(s.isActionRelatedToCurrentProperty&&o.push(s.actionId),o),[]),an=(t,n,o,s,a)=>{const c=rn(t).reduce((d,m)=>{const u=[...o.split(".."),m,"properties",s,a],p=A()(n,u,!1);return d[m]=p,d},{});return Ae(c)},yt=(0,h.ZP)(S.k)`
  width: ${z};
  position: relative;
`,ln=(0,h.ZP)(S.k)`
  height: ${Me};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Ve} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${We(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&We(n)};
`,Qe=({childrenForm:t,label:n,isFormDisabled:o,name:s,required:a,pathToData:l,propertyActions:c,propertyName:d,isOdd:m})=>{const{formatMessage:u}=(0,Z.Z)(),[p,f]=(0,e.useState)(null),{modifiedData:v,onChangeCollectionTypeLeftActionRowCheckbox:F,onChangeParentCheckbox:x,onChangeSimpleCheckbox:C}=te(),g=p===s,T=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),R=T.length>0,O=(0,e.useCallback)(()=>{R&&f(B=>B===s?null:s)},[R,s]),X=({target:{value:B}})=>{F(l,d,s,B)},{hasAllActionsSelected:N,hasSomeActionsSelected:G}=(0,e.useMemo)(()=>an(c,v,l,d,s),[c,v,l,d,s]);return e.createElement(e.Fragment,null,e.createElement(ln,{alignItems:"center",isCollapsable:R,isActive:g,background:m?"neutral100":"neutral0"},e.createElement(S.k,null,e.createElement(at,{onChange:X,onClick:O,isCollapsable:R,isFormDisabled:o,label:n,someChecked:G,value:N,isActive:g},a&&e.createElement(gt,null),e.createElement(Ve,{$isActive:g})),e.createElement(S.k,null,c.map(({label:B,isActionRelatedToCurrentProperty:ie,actionId:Le})=>{if(!ie)return e.createElement(Ue,{key:B});const Y=[...l.split(".."),Le,"properties",d,s];if(!R){const Te=A()(v,Y,!1);return e.createElement(yt,{key:Le,justifyContent:"center",alignItems:"center"},e.createElement(Q.C,{disabled:o,name:Y.join(".."),"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${B}`}),onValueChange:ns=>{C({target:{name:Y.join(".."),value:ns}})},value:Te}))}const ge=A()(v,Y,{}),{hasAllActionsSelected:He,hasSomeActionsSelected:xe}=Ae(ge);return e.createElement(yt,{key:B,justifyContent:"center",alignItems:"center"},e.createElement(Q.C,{disabled:o,name:Y.join(".."),onValueChange:Te=>{x({target:{name:Y.join(".."),value:Te}})},"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${B}`}),value:He,indeterminate:xe}))})))),g&&e.createElement(on,{childrenForm:T,isFormDisabled:o,parentName:s,pathToDataFromActionRow:l,propertyName:d,propertyActions:c,recursiveLevel:0}))};Qe.defaultProps={childrenForm:[],required:!1},Qe.propTypes={childrenForm:r().array,label:r().string.isRequired,isFormDisabled:r().bool.isRequired,name:r().string.isRequired,pathToData:r().string.isRequired,propertyActions:r().array.isRequired,propertyName:r().string.isRequired,required:r().bool,isOdd:r().bool.isRequired};const cn=(0,e.memo)(Qe),Ct=(0,h.ZP)(S.k)`
  width: ${z};
  flex-shrink: 0;
`,dn=(0,h.ZP)(S.k)`
  width: ${Pe};
  height: ${Me};
  flex-shrink: 0;
`,ht=({headers:t,label:n})=>{const{formatMessage:o}=(0,Z.Z)(),s=o({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(S.k,null,e.createElement(dn,{alignItems:"center",paddingLeft:6},e.createElement(j.Z,{variant:"sigma",textColor:"neutral500"},s)),t.map(a=>a.isActionRelatedToCurrentProperty?e.createElement(Ct,{justifyContent:"center",key:a.label},e.createElement(j.Z,{variant:"sigma",textColor:"neutral500"},o({id:`Settings.roles.form.permissions.${a.label.toLowerCase()}`,defaultMessage:a.label}))):e.createElement(Ct,{key:a.label})))};ht.propTypes={headers:r().arrayOf(r().shape({label:r().string.isRequired,isActionRelatedToCurrentProperty:r().bool.isRequired})).isRequired,label:r().string.isRequired};const un=ht,mn=(t,n)=>t.map(o=>{const s=Array.isArray(o.applyToProperties)&&o.applyToProperties.indexOf(n)!==-1&&o.isDisplayed;return{label:o.label,actionId:o.actionId,isActionRelatedToCurrentProperty:s}}),pn=h.ZP.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,Et=({availableActions:t,childrenForm:n,isFormDisabled:o,label:s,pathToData:a,propertyName:l})=>{const c=(0,e.useMemo)(()=>mn(t,l),[t,l]);return e.createElement(pn,null,e.createElement(un,{label:s,headers:c}),e.createElement(y.x,null,n.map(({children:d,label:m,value:u,required:p},f)=>e.createElement(cn,{childrenForm:d,key:u,label:m,isFormDisabled:o,name:u,required:p,propertyActions:c,pathToData:a,propertyName:l,isOdd:f%2===0}))))};Et.propTypes={childrenForm:r().array.isRequired,availableActions:r().array.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,pathToData:r().string.isRequired,propertyName:r().string.isRequired};const gn=Et,fn=h.ZP.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,bt=({allActions:t,contentTypeName:n,label:o,index:s,isActive:a,isFormDisabled:l,onClickToggleCollapse:c,pathToData:d,properties:m})=>{const u=(0,e.useCallback)(()=>{c(n)},[n,c]),p=(0,e.useMemo)(()=>qt(t,n),[t,n]);return e.createElement(fn,{isActive:a},e.createElement(Xt,{availableActions:p,isActive:a,isGrey:s%2===0,isFormDisabled:l,label:o,onClickToggle:u,pathToData:d}),a&&m.map(({label:f,value:v,children:F})=>e.createElement(gn,{availableActions:p,childrenForm:F,isFormDisabled:l,label:f,pathToData:d,propertyName:v,key:v})))};bt.propTypes={allActions:r().array.isRequired,contentTypeName:r().string.isRequired,index:r().number.isRequired,isActive:r().bool.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,onClickToggleCollapse:r().func.isRequired,pathToData:r().string.isRequired,properties:r().array.isRequired};const yn=bt,Je=({actions:t,isFormDisabled:n,pathToData:o,subjects:s})=>{const[a,l]=(0,e.useState)(null),c=d=>{l(a===d?null:d)};return s.map(({uid:d,label:m,properties:u},p)=>e.createElement(yn,{allActions:t,key:d,contentTypeName:d,label:m,isActive:a===d,isFormDisabled:n,index:p,onClickToggleCollapse:c,pathToData:`${o}..${d}`,properties:u}))};Je.defaultProps={actions:[],subjects:[]},Je.propTypes={actions:r().array.isRequired,isFormDisabled:r().bool.isRequired,pathToData:r().string.isRequired,subjects:r().arrayOf(r().shape({uid:r().string.isRequired,label:r().string.isRequired,properties:r().array.isRequired}))};const Cn=(0,e.memo)(Je),hn=t=>t.filter(({subjects:n})=>n&&n.length),En=t=>t.map(({actionId:n})=>n),bn=(t,n)=>t.reduce((o,s)=>(Object.keys(n).forEach(a=>{const l=A()(n,[a,s],{}),c={[a]:Xe(l)};o[s]?o[s]={...o[s],...c}:o[s]=c}),o),{}),vn=(t,n)=>{const o=En(t),s=bn(o,n);return Object.keys(s).reduce((l,c)=>(l[c]=Ae(s[c]),l),{})},Rn=(0,h.ZP)(S.k)`
  width: ${z};
  flex-shrink: 0;
`,_e=({actions:t,isFormDisabled:n,kind:o})=>{const{formatMessage:s}=(0,Z.Z)(),{modifiedData:a,onChangeCollectionTypeGlobalActionCheckbox:l}=te(),c=(0,e.useMemo)(()=>hn(t),[t]),d=(0,e.useMemo)(()=>vn(c,a[o]),[a,c,o]);return e.createElement(y.x,{paddingBottom:4,paddingTop:6,style:{paddingLeft:Pe}},e.createElement(S.k,{gap:0},c.map(({label:m,actionId:u})=>e.createElement(Rn,{direction:"column",alignItems:"center",justifyContent:"center",key:u,gap:3},e.createElement(j.Z,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})),e.createElement(Q.C,{disabled:n,onValueChange:p=>{l(o,u,p)},name:u,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})}),value:A()(d,[u,"hasAllActionsSelected"],!1),indeterminate:A()(d,[u,"hasSomeActionsSelected"],!1)})))))};_e.defaultProps={actions:[]},_e.propTypes={actions:r().arrayOf(r().shape({label:r().string.isRequired,actionId:r().string.isRequired,subjects:r().array.isRequired})),isFormDisabled:r().bool.isRequired,kind:r().string.isRequired};const Pn=(0,e.memo)(_e),An=(0,h.ZP)(y.x)`
  overflow-x: auto;
`,vt=({isFormDisabled:t,kind:n,layout:{actions:o,subjects:s}})=>{const a=he()([...s],"label");return e.createElement(An,{background:"neutral0"},e.createElement(Pn,{actions:o,kind:n,isFormDisabled:t}),e.createElement(Cn,{actions:o,isFormDisabled:t,pathToData:n,subjects:a}))};vt.propTypes={isFormDisabled:r().bool.isRequired,kind:r().string.isRequired,layout:r().shape({actions:r().array,subjects:r().arrayOf(r().shape({uid:r().string.isRequired,label:r().string.isRequired,properties:r().array.isRequired}))}).isRequired};const Rt=(0,e.memo)(vt),Pt=({children:t,value:n})=>e.createElement(ne.Provider,{value:n},t);Pt.propTypes={children:r().node.isRequired,value:r().exact({availableConditions:r().array.isRequired,modifiedData:r().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:r().func.isRequired,onChangeConditions:r().func.isRequired,onChangeSimpleCheckbox:r().func.isRequired,onChangeParentCheckbox:r().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:r().func.isRequired}).isRequired};const xn=Pt;var Tn=i(63122),Sn=i(1744),On=i(68889),At=i(22546),Mn=i(31988),$n=i(6498);const Ln=(t,n,o)=>t.map(s=>{const a=[...o,s.action,"properties","enabled"],l=A()(n,a,!1),c=A()(n,[...o,s.action,"conditions"],{}),d=$e(c).some(m=>m);return{...s,isDisplayed:l,checkboxName:a.join(".."),hasSomeActionsSelected:l,value:l,hasConditions:d,label:s.displayName,actionId:s.action,pathToConditionsObject:[...o,s.action]}}),Dn=t=>{const n=Object.entries(t).reduce((s,a)=>{const[l,{conditions:c}]=a;return s[l]=c,s},{});return $e(n).some(s=>s)},kn=h.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,jn=h.ZP.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,xt=({categoryName:t,isFormDisabled:n,subCategoryName:o,actions:s,pathToData:a})=>{const[l,c]=(0,e.useState)(!1),{modifiedData:d,onChangeParentCheckbox:m,onChangeSimpleCheckbox:u}=te(),{formatMessage:p}=(0,Z.Z)(),f=A()(d,a,{}),v=(0,e.useMemo)(()=>Object.keys(f).reduce((O,X)=>(O[X]=Xe(f[X]),O),{}),[f]),{hasAllActionsSelected:F,hasSomeActionsSelected:x}=Ae(v),C=()=>{c(O=>!O)},g=()=>{c(!1)},T=Ln(s,d,a),R=Dn(A()(d,[...a],{}));return e.createElement(e.Fragment,null,e.createElement(y.x,null,e.createElement(S.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(y.x,{paddingRight:4},e.createElement(j.Z,{variant:"sigma",textColor:"neutral600"},o)),e.createElement(kn,null),e.createElement(y.x,{paddingLeft:4},e.createElement(At.X,{name:a.join(".."),disabled:n,onValueChange:O=>{m({target:{name:a.join(".."),value:O}})},indeterminate:x,value:F},p({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(S.k,{paddingTop:6,paddingBottom:6},e.createElement(Mn.r,{gap:2,style:{flex:1}},T.map(({checkboxName:O,value:X,action:N,displayName:G,hasConditions:B})=>e.createElement($n.P,{col:3,key:N},e.createElement(jn,{disabled:n,hasConditions:B},e.createElement(At.X,{name:O,disabled:n,onValueChange:ie=>{u({target:{name:O,value:ie}})},value:X},G))))),e.createElement(fe,{hasConditions:R,onClick:C}))),l&&e.createElement(pe,{headerBreadCrumbs:[t,o],actions:T,isFormDisabled:n,onClosed:g,onToggle:C}))};xt.propTypes={actions:r().array.isRequired,categoryName:r().string.isRequired,isFormDisabled:r().bool.isRequired,subCategoryName:r().string.isRequired,pathToData:r().array.isRequired};const Fn=xt,et=({childrenForm:t,kind:n,name:o,isOpen:s,isFormDisabled:a,isWhite:l,onOpenCategory:c,pathToData:d})=>{const{formatMessage:m}=(0,Z.Z)(),u=()=>{c(o)},p=(0,e.useMemo)(()=>o.split("::").pop(),[o]);return e.createElement(Tn.U,{expanded:s,onToggle:u,id:`accordion-${o}`,variant:l?"primary":"secondary"},e.createElement(Sn.B,{title:ue()(p),description:`${m({id:"Settings.permissions.category"},{category:p})} ${n==="plugins"?"plugin":n}`}),e.createElement(On.v,null,e.createElement(y.x,{padding:6},t.map(({actions:f,subCategoryName:v,subCategoryId:F})=>e.createElement(Fn,{key:v,actions:f,categoryName:p,isFormDisabled:a,subCategoryName:v,pathToData:[...d,F]})))))};et.defaultProps={},et.propTypes={childrenForm:r().array.isRequired,isOpen:r().bool.isRequired,isFormDisabled:r().bool.isRequired,isWhite:r().bool.isRequired,kind:r().string.isRequired,name:r().string.isRequired,onOpenCategory:r().func.isRequired,pathToData:r().array.isRequired};const In=et,Tt=({isFormDisabled:t,kind:n,layout:o})=>{const[s,a]=(0,e.useState)(null),l=c=>{a(c===s?null:c)};return e.createElement(y.x,{padding:6,background:"neutral0"},o.map(({category:c,categoryId:d,childrenForm:m},u)=>e.createElement(In,{key:c,childrenForm:m,kind:n,isFormDisabled:t,isOpen:s===c,isWhite:u%2===1,name:c,onOpenCategory:l,pathToData:[n,d]})))};Tt.propTypes={isFormDisabled:r().bool.isRequired,kind:r().string.isRequired,layout:r().arrayOf(r().shape({category:r().string.isRequired,categoryId:r().string.isRequired,childrenForm:r().arrayOf(r().shape({actions:r().array.isRequired})).isRequired}).isRequired).isRequired};const St=Tt;var Zn=i(82492),Bn=i.n(Zn),Nn=i(36968),re=i.n(Nn);const Ot=(t,n,o)=>t.find(s=>s.action===n&&s.subject===o),Mt=(t,n=[])=>t.reduce((o,s)=>(o[s.id]=n.indexOf(s.id)!==-1,o),{}),$t=({children:t},n,o="")=>t.reduce((s,a)=>{if(a.children)return{...s,[a.value]:$t(a,n,`${o}${a.value}.`)};const l=n.indexOf(`${o}${a.value}`)!==-1;return s[a.value]=l,s},{}),Vn=(t,n,o)=>t.reduce((s,a)=>{const l=n.properties.find(({value:c})=>c===a);if(l){const c=A()(o,["properties",l.value],[]),d=$t(l,c);s.properties[a]=d}return s},{properties:{}}),Wn=(t,n)=>n.reduce((o,s)=>{const a=t.find(({uid:l})=>l===s)||null;return a&&(o[s]=a),o},{}),Lt=({subjects:t},n,o,s=[])=>n.reduce((a,l)=>{const c=l.subjects,d=Wn(t,c);if(I()(d))return a;const m=Object.keys(d).reduce((u,p)=>{const{actionId:f,applyToProperties:v}=l,C=d[p].properties.map(({value:O})=>O).every(O=>(v||[]).indexOf(O)===-1),g=Ot(s,f,p),T=Mt(o,A()(g,"conditions",[]));if(I()(v)||C)return re()(u,[p,f],{properties:{enabled:g!==void 0},conditions:T}),u;const R=Vn(v,d[p],g);return re()(u,[p,f],{...R,conditions:T}),u},{});return Bn()(a,m)},{}),Hn=(t,n,o)=>t.reduce((s,a)=>{const l=Ot(o,a.action,null);return s[a.action]={properties:{enabled:l!==void 0},conditions:Mt(n,l?.conditions??[])},s},{}),Gn=(t,n,o)=>t.reduce((s,a)=>(s[a.subCategoryId]=Hn(a.actions,n,o),s),{}),Dt=(t,n,o=[])=>t.reduce((s,{categoryId:a,childrenForm:l})=>{const c=Gn(l,n,o);return s[a]=c,s},{}),kt=t=>t.split(" ").join("-"),jt=(t,n)=>Object.entries(W()(t,n)).map(([o,s])=>({category:o,categoryId:kt(o),childrenForm:Object.entries(W()(s,"subCategory")).map(([a,l])=>({subCategoryName:a,subCategoryId:kt(a),actions:l}))})),Kn=(t,n)=>{const{conditions:o,sections:{collectionTypes:s,singleTypes:a,plugins:l,settings:c}}=t,d={collectionTypes:s,singleTypes:a,plugins:jt(l,"plugin"),settings:jt(c,"category")},m={collectionTypes:Lt(s,s.actions||[],o,n),singleTypes:Lt(a,a.actions||[],o,n),plugins:Dt(d.plugins,o,n),settings:Dt(d.settings,o,n)};return{initialData:m,modifiedData:m,layouts:d}};var Un=i(50361),tt=i.n(Un);const Ft=t=>Object.keys(t).reduce((n,o)=>{const s=t[o];if(Ce()(s)&&!P()(s,"conditions"))return{...n,[o]:Ft(s)};if(Ce()(s)&&P()(s,"conditions")&&!$e(Se()(s,"conditions")).some(l=>l)){const l=Object.keys(s.conditions).reduce((c,d)=>(c[d]=!1,c),{});return{...n,[o]:{...s,conditions:l}}}return n[o]=s,n},{}),nt=Ft,It=(t,n,o=!1)=>Object.keys(t).reduce((s,a)=>{const l=t[a];return a==="conditions"&&!o?(s[a]=l,s):Ce()(l)?{...s,[a]:It(l,n,a==="fields")}:(s[a]=n,s)},{}),Ke=It,zn={initialData:{},modifiedData:{},layouts:{}},Xn=(t,n)=>(0,se.ZP)(t,o=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:a,value:l}=n,c=["modifiedData",s];Object.keys(A()(t,c)).forEach(d=>{const m=A()(t,[...c,d,a],void 0);if(m){let u=Ke(m,l);if(!l&&u.conditions){const p=Ke(u.conditions,!1);u={...u,conditions:p}}re()(o,[...c,d,a],u)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:a,rowName:l,value:c}=n;let d=tt()(t.modifiedData);const m=s.split(".."),u=A()(d,m,{});Object.keys(u).forEach(p=>{if(P()(u[p],`properties.${a}`)){const f=A()(u,[p,"properties",a,l]),v=[...m,p,"properties",a,l];if(!Ce()(f))re()(d,v,c);else{const F=Ke(f,c);re()(d,v,F)}}}),c||(d=nt(d)),re()(o,"modifiedData",d);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[a,l]=s;re()(o,["modifiedData",...a.split(".."),"conditions"],l)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=tt()(t.modifiedData);re()(s,[...n.keys.split("..")],n.value),n.value||(s=nt(s)),re()(o,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:a}=n,l=[...s.split("..")];let c=tt()(t.modifiedData);const d=A()(c,l,{}),m=Ke(d,a);re()(c,l,m),a||(c=nt(c)),re()(o,["modifiedData"],c);break}case"RESET_FORM":{o.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{o.initialData=t.modifiedData;break}default:return o}}),st=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),wn=t=>{const[n,{conditions:o}]=t;return{action:n,subject:null,conditions:st(o),properties:{}}},qn=t=>Object.values(t).reduce((n,o)=>{const s=Object.entries(o).reduce((a,l)=>{const[,{properties:{enabled:c}}]=l;if(!c)return a;const d=wn(l);return a.push(d),a},[]);return[...n,...s]},[]),Zt=t=>Object.values(t).reduce((n,o)=>{const s=qn(o);return[...n,...s]},[]),Bt=(t,n="")=>Object.entries(t).reduce((o,s)=>{const[a,l]=s;return Ce()(l)?[...o,...Bt(l,`${n}${a}.`)]:(l&&!Ce()(l)&&o.push(`${n}${a}`),o)},[]),Yn=(t,n,{conditions:o,properties:s})=>Object.entries(s).reduce((a,l)=>{const[c,d]=l;return a.properties[c]=Bt(d),a},{action:t,subject:n,conditions:st(o),properties:{}}),Qn=(t,n,{conditions:o})=>({action:t,subject:n,properties:{},conditions:st(o)}),Jn=(t,n)=>Object.entries(n).reduce((s,a)=>{const[l,c]=a;if(!$e(c).some(u=>u))return s;if(!c?.properties?.enabled){const u=Yn(l,t,c);return[...s,u]}if(!c.properties.enabled)return s;const m=Qn(l,t,c);return s.push(m),s},[]),Nt=t=>Object.entries(t).reduce((o,s)=>{const[a,l]=s,c=Jn(a,l);return[...o,...c]},[]),_n=t=>{const n=Zt(t.plugins),o=Zt(t.settings),s=Nt(t.collectionTypes),a=Nt(t.singleTypes);return[...n,...o,...s,...a]},es=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}],ot=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:o},s)=>{const[{initialData:a,layouts:l,modifiedData:c},d]=(0,e.useReducer)(Xn,zn,()=>Kn(t,o)),{formatMessage:m}=(0,Z.Z)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const x=(0,k.difference)(a.collectionTypes,c.collectionTypes),C=(0,k.difference)(a.singleTypes,c.singleTypes),g={...x,...C};let T;return I()(g)?T=!1:T=Object.values(g).some(R=>Object.values(R).some(O=>P()(O,"conditions"))),{permissionsToSend:_n(c),didUpdateConditions:T}},resetForm(){d({type:"RESET_FORM"})},setFormAfterSubmit(){d({type:"SET_FORM_AFTER_SUBMIT"})}}));const u=(x,C,g,T)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:x,propertyName:C,rowName:g,value:T})},p=(x,C,g)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:x,actionId:C,value:g})},f=x=>{d({type:"ON_CHANGE_CONDITIONS",conditions:x})},v=(0,e.useCallback)(({target:{name:x,value:C}})=>{d({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:x,value:C})},[]),F=(0,e.useCallback)(({target:{name:x,value:C}})=>{d({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:x,value:C})},[]);return e.createElement(xn,{value:{availableConditions:t.conditions,modifiedData:c,onChangeConditions:f,onChangeSimpleCheckbox:v,onChangeParentCheckbox:F,onChangeCollectionTypeLeftActionRowCheckbox:u,onChangeCollectionTypeGlobalActionCheckbox:p}},e.createElement(b.v,{id:"tabs",label:m({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement(D.m,null,es.map(x=>e.createElement(D.O,{key:x.id},m({id:x.labelId,defaultMessage:x.defaultMessage})))),e.createElement(E.n,{style:{position:"relative"}},e.createElement(E.x,null,e.createElement(Rt,{layout:l.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(E.x,null,e.createElement(Rt,{layout:l.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(E.x,null,e.createElement(St,{layout:l.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(E.x,null,e.createElement(St,{layout:l.settings,kind:"settings",isFormDisabled:n})))))});ot.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},ot.propTypes={layout:r().object,isFormDisabled:r().bool.isRequired,permissions:r().array};const ts=(0,e.memo)(ot)},63727:(U,V,i)=>{"use strict";i.r(V),i.d(V,{default:()=>Oe});var e=i(67294),b=i(32638),D=i(86706),E=i(16550),k=i(36364),$=i(40720),P=i(90731),L=i(96987),I=i(12473),w=i(34726),r=i(16607),Z=i(97695),y=i(41054),ae=i(86896),he=i(98374),h=i(90065),S=i(24233),Q=i(30909),ee=i(71068),Ee=i(31988),le=i(6498),A=i(38670),De=i(457),Se=i(45697),ne=i.n(Se);const te=({disabled:j,role:K,values:M,errors:J,onChange:se,onBlur:de})=>{const{formatMessage:W}=(0,ae.Z)();return e.createElement(r.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(L.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(L.k,{justifyContent:"space-between"},e.createElement(r.x,null,e.createElement(r.x,null,e.createElement(ee.Z,{fontWeight:"bold"},K?K.name:W({id:"global.details",defaultMessage:"Details"}))),e.createElement(r.x,null,e.createElement(ee.Z,{textColor:"neutral500",variant:"pi"},K?K.description:W({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(I.z,{disabled:!0,variant:"secondary"},W({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:K.usersCount}))),e.createElement(Ee.r,{gap:4},e.createElement(le.P,{col:6},e.createElement(A.o,{disabled:j,name:"name",error:J.name&&W({id:J.name}),label:W({id:"global.name",defaultMessage:"Name"}),onChange:se,onBlur:de,required:!0,value:M.name||""})),e.createElement(le.P,{col:6},e.createElement(De.g,{disabled:j,label:W({id:"global.description",defaultMessage:"Description"}),id:"description",error:J.name&&W({id:J.name}),onChange:se,onBlur:de},M.description||"")))))};te.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},te.propTypes={disabled:ne().bool,errors:ne().object.isRequired,onBlur:ne().func.isRequired,onChange:ne().func.isRequired,role:ne().object,values:ne().object};const ce=te;var ke=i(87561);const be=ke.Ry().shape({name:ke.Z_().required(b.translatedErrors.required)}),je=()=>{const j=(0,b.useNotification)(),{formatMessage:K}=(0,ae.Z)(),{params:{id:M}}=(0,E.$B)("/settings/roles/:id"),{put:J}=(0,b.useFetchClient)(),[se,de]=(0,e.useState)(!1),W=(0,e.useRef)(),{lockApp:ye,unlockApp:ue}=(0,b.useOverlayBlocker)(),{trackUsage:Fe}=(0,b.useTracking)(),{formatAPIError:me}=(0,b.useAPIErrorHandler)(),{isLoading:Ie,data:Ze}=(0,h.d)(M,{cacheTime:0}),{roles:[oe={}],isLoading:ve,refetch:Be}=(0,he.F)({id:M},{cacheTime:0}),{permissions:Ne,isLoading:Re}=(0,S.V)({id:M},{cacheTime:0}),q=async pe=>{try{ye(),de(!0);const{permissionsToSend:z,didUpdateConditions:Pe}=W.current.getPermissions();await J(`/admin/roles/${M}`,pe),oe.code!=="strapi-super-admin"&&(await J(`/admin/roles/${M}/permissions`,{permissions:z}),Pe&&Fe("didUpdateConditions")),W.current.setFormAfterSubmit(),await Be(),j({type:"success",message:{id:"notification.success.saved"}})}catch(z){j({type:"warning",message:me(z)})}finally{de(!1),ue()}},_=!ve&&oe.code==="strapi-super-admin";return e.createElement($.o,null,e.createElement(b.SettingsPageTitle,{name:"Roles"}),e.createElement(y.J9,{enableReinitialize:!0,initialValues:{name:oe.name,description:oe.description},onSubmit:q,validationSchema:be,validateOnChange:!1},({handleSubmit:pe,values:z,errors:Pe,handleChange:Me,handleBlur:rt})=>e.createElement("form",{onSubmit:pe},e.createElement(P.T,{primaryAction:e.createElement(L.k,{gap:2},e.createElement(I.z,{disabled:oe.code==="strapi-super-admin",onClick:pe,loading:se,size:"L"},K({id:"global.save",defaultMessage:"Save"}))),title:K({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:K({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(b.Link,{startIcon:e.createElement(Z.Z,null),to:"/settings/roles"},K({id:"global.back",defaultMessage:"Back"}))}),e.createElement(w.D,null,e.createElement(L.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(ce,{isLoading:ve||Re,disabled:_,errors:Pe,values:z,onChange:Me,onBlur:rt,role:oe}),!Ie&&!ve&&!Re?e.createElement(r.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(Q.Z,{isFormDisabled:_,permissions:Ne,ref:W,layout:Ze})):e.createElement(r.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(b.LoadingIndicatorPage,null)))))))},Oe=()=>{const j=(0,D.v9)(k._),{isLoading:K,allowedActions:{canRead:M,canUpdate:J}}=(0,b.useRBAC)({read:j.settings.roles.read,update:j.settings.roles.update});return K?e.createElement(b.LoadingIndicatorPage,null):!M&&!J?e.createElement(E.l_,{to:"/"}):e.createElement(je,null)}},90065:(U,V,i)=>{"use strict";i.d(V,{d:()=>D});var e=i(32638),b=i(88767);const D=(E,k={})=>{const{get:$}=(0,e.useFetchClient)(),{data:P,error:L,isError:I,isLoading:w}=(0,b.useQuery)(["permissions",E],async()=>{const{data:{data:r}}=await $("/admin/permissions",{params:{role:E}});return r},k);return{data:P,error:L,isError:I,isLoading:w}}},44174:U=>{function V(i,e,b,D){for(var E=-1,k=i==null?0:i.length;++E<k;){var $=i[E];e(D,$,b($),i)}return D}U.exports=V},81119:(U,V,i)=>{var e=i(89881);function b(D,E,k,$){return e(D,function(P,L,I){E($,P,k(P),I)}),$}U.exports=b},9872:(U,V,i)=>{var e=i(44174),b=i(81119),D=i(67206),E=i(1469);function k($,P){return function(L,I){var w=E(L)?e:b,r=P?P():{};return w(L,$,D(I,2),r)}}U.exports=k},42348:(U,V,i)=>{var e=i(21078),b=1/0;function D(E){var k=E==null?0:E.length;return k?e(E,b):[]}U.exports=D},7739:(U,V,i)=>{var e=i(89465),b=i(9872),D=Object.prototype,E=D.hasOwnProperty,k=b(function($,P,L){E.call($,L)?$[L].push(P):e($,L,[P])});U.exports=k}}]);
